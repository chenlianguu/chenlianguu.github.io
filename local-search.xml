<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Apache Airflowä½¿ç”¨æŒ‡å—</title>
    <link href="/2020/01/09/Apache-Airflow%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
    <url>/2020/01/09/Apache-Airflow%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>airflow æ˜¯ apacheä¸‹å­µåŒ–é¡¹ç›®ï¼Œæ˜¯çº¯ Python ç¼–å†™çš„ä¸€æ¬¾éå¸¸ä¼˜é›…çš„å¼€æºè°ƒåº¦å¹³å°ã€‚github ä¸Šæœ‰ 8971 ä¸ªæ˜Ÿï¼Œæ˜¯éå¸¸å—æ¬¢è¿çš„è°ƒåº¦å·¥å…·ã€‚airflow ä½¿ç”¨ DAG (æœ‰å‘æ— ç¯å›¾) æ¥å®šä¹‰å·¥ä½œæµï¼Œé…ç½®ä½œä¸šä¾èµ–å…³ç³»éå¸¸æ–¹ä¾¿ï¼Œè±ªä¸å¤¸å¼ åœ°è¯´ï¼šæ–¹ä¾¿ç¨‹åº¦ç®€ç›´ç”©å…¶ä»–ä»»åŠ¡è°ƒåº¦å·¥å…·ä¸€æ¡è¡—ã€‚<br> airflow æœ‰ç€ä»¥ä¸‹å¤©ç„¶ä¼˜åŠ¿ï¼š</p><ol><li>çµæ´»æ˜“ç”¨ï¼Œairflow æœ¬èº«æ˜¯ Python ç¼–å†™çš„ï¼Œä¸”å·¥ä½œæµçš„å®šä¹‰ä¹Ÿæ˜¯ Python ç¼–å†™ï¼Œæœ‰äº† Python èƒ¶æ°´çš„ç‰¹æ€§ï¼Œæ²¡æœ‰ä»€ä¹ˆä»»åŠ¡æ˜¯è°ƒåº¦ä¸äº†çš„ï¼Œæœ‰äº†å¼€æºçš„ä»£ç ï¼Œæ²¡æœ‰ä»€ä¹ˆé—®é¢˜æ˜¯æ— æ³•è§£å†³çš„ï¼Œä½ å®Œå…¨å¯ä»¥ä¿®æ”¹æºç æ¥æ»¡è¶³ä¸ªæ€§åŒ–çš„éœ€æ±‚ï¼Œè€Œä¸”æ›´é‡è¦çš„æ˜¯ä»£ç éƒ½æ˜¯ <strong>â€“human-readable</strong> ã€‚</li><li>åŠŸèƒ½å¼ºå¤§ï¼Œè‡ªå¸¦çš„ Operators éƒ½æœ‰15+ï¼Œä¹Ÿå°±æ˜¯è¯´æœ¬èº«å·²ç»æ”¯æŒ 15+ ä¸åŒç±»å‹çš„ä½œä¸šï¼Œè€Œä¸”è¿˜æ˜¯å¯è‡ªå®šä¹‰ Operatorsï¼Œä»€ä¹ˆ shell è„šæœ¬ï¼Œpythonï¼Œmysqlï¼Œoracleï¼Œhiveç­‰ç­‰ï¼Œæ— è®ºä¸ä¼ ç»Ÿæ•°æ®åº“å¹³å°è¿˜æ˜¯å¤§æ•°æ®å¹³å°ï¼Œç»Ÿç»Ÿä¸åœ¨è¯ä¸‹ï¼Œå¯¹å®˜æ–¹æä¾›çš„ä¸æ»¡è¶³ï¼Œå®Œå…¨å¯ä»¥è‡ªå·±ç¼–å†™ Operatorsã€‚</li><li>ä¼˜é›…ï¼Œä½œä¸šçš„å®šä¹‰å¾ˆç®€å•æ˜äº†, åŸºäº jinja æ¨¡æ¿å¼•æ“å¾ˆå®¹æ˜“åšåˆ°è„šæœ¬å‘½ä»¤å‚æ•°åŒ–ï¼Œweb ç•Œé¢æ›´æ˜¯ä¹Ÿéå¸¸ <strong>â€“human-readable</strong> ã€‚</li><li>ææ˜“æ‰©å±•ï¼Œæä¾›å„ç§åŸºç±»ä¾›æ‰©å±•, è¿˜æœ‰å¤šç§æ‰§è¡Œå™¨å¯ä¾›é€‰æ‹©ï¼Œå…¶ä¸­ CeleryExcutor ä½¿ç”¨äº†æ¶ˆæ¯é˜Ÿåˆ—æ¥ç¼–æ’å¤šä¸ªå·¥ä½œèŠ‚ç‚¹(worker), å¯åˆ†å¸ƒå¼éƒ¨ç½²å¤šä¸ª worker ï¼Œairflow å¯ä»¥åšåˆ°æ— é™æ‰©å±•ã€‚</li><li>ä¸°å¯Œçš„å‘½ä»¤å·¥å…·ï¼Œä½ ç”šè‡³éƒ½ä¸ç”¨æ‰“å¼€æµè§ˆå™¨ï¼Œç›´æ¥åœ¨ç»ˆç«¯æ•²å‘½ä»¤å°±èƒ½å®Œæˆæµ‹è¯•ï¼Œéƒ¨ç½²ï¼Œè¿è¡Œï¼Œæ¸…ç†ï¼Œé‡è·‘ï¼Œè¿½æ•°ç­‰ä»»åŠ¡ã€‚</li></ol><p>airflow æ˜¯å…è´¹çš„ï¼Œå¯ä»¥å°†ä¸€äº›å¸¸åšçš„å·¡æ£€ä»»åŠ¡ï¼Œå®šæ—¶è„šæœ¬ï¼ˆå¦‚ crontab ï¼‰ï¼ŒETLå¤„ç†ï¼Œç›‘æ§ç­‰ä»»åŠ¡æ”¾åœ¨ airflow ä¸Šé›†ä¸­ç®¡ç†ï¼Œç”šè‡³éƒ½ä¸ç”¨å†å†™ç›‘æ§è„šæœ¬ï¼Œä½œä¸šå‡ºé”™ä¼šè‡ªåŠ¨å‘é€æ—¥å¿—åˆ°æŒ‡å®šäººå‘˜é‚®ç®±ï¼Œä½æˆæœ¬é«˜æ•ˆç‡åœ°è§£å†³ç”Ÿäº§é—®é¢˜ã€‚</p><h2 id="ç»„æˆéƒ¨åˆ†"><a href="#ç»„æˆéƒ¨åˆ†" class="headerlink" title="ç»„æˆéƒ¨åˆ†"></a>ç»„æˆéƒ¨åˆ†</h2><p>ä»ä¸€ä¸ªä½¿ç”¨è€…çš„è§’åº¦æ¥çœ‹ï¼Œè°ƒåº¦å·¥ä½œéƒ½æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š</p><ol><li>ç³»ç»Ÿé…ç½®ï¼ˆ$AIRFLOW_HOME/airflow.cfgï¼‰</li><li>ä½œä¸šç®¡ç†ï¼ˆ$AIRFLOW_HOME/dags/xxxx.pyï¼‰</li><li>è¿è¡Œç›‘æ§ï¼ˆwebserver)</li><li>æŠ¥è­¦ï¼ˆé‚®ä»¶æˆ–çŸ­ä¿¡ï¼‰</li><li>æ—¥å¿—æŸ¥çœ‹ï¼ˆwebserver æˆ– $AIRFLOW_HOME/logs/***)</li><li>è·‘æ‰¹è€—æ—¶åˆ†æï¼ˆwebserver)</li><li>åå°è°ƒåº¦æœåŠ¡ï¼ˆscheduler)</li></ol><p>é™¤äº†çŸ­ä¿¡éœ€è¦è‡ªå·±å®ç°ï¼Œå…¶ä»–åŠŸèƒ½ airflow éƒ½æœ‰ï¼Œè€Œä¸”åœ¨ airflow çš„ webserver ä¸Šæˆ‘ä»¬å¯ä»¥ç›´æ¥é…ç½®æ•°æ®åº“è¿æ¥æ¥å†™ sql æŸ¥è¯¢ï¼Œåšæ›´åŠ çµæ´»çš„ç»Ÿè®¡åˆ†æã€‚</p><h2 id="é‡è¦æ¦‚å¿µ"><a href="#é‡è¦æ¦‚å¿µ" class="headerlink" title="é‡è¦æ¦‚å¿µ"></a>é‡è¦æ¦‚å¿µ</h2><h3 id="DAG"><a href="#DAG" class="headerlink" title="DAG"></a>DAG</h3><p>Linux çš„ crontab å’Œ windows çš„ä»»åŠ¡è®¡åˆ’ï¼Œä»–ä»¬å¯ä»¥é…ç½®å®šæ—¶ä»»åŠ¡æˆ–é—´éš”ä»»åŠ¡ï¼Œä½†ä¸èƒ½é…ç½®ä½œä¸šä¹‹å‰çš„ä¾èµ–å…³ç³»ã€‚airflow ä¸­ DAG å°±æ˜¯ç®¡ç†ä½œä¸šä¾èµ–å…³ç³»çš„ã€‚DAG çš„è‹±æ–‡ directed acyclic graphs å³æœ‰å‘æ— ç¯å›¾ï¼Œä¸‹å›¾ 1 ä¾¿æ˜¯ä¸€ä¸ªç®€å•çš„ DAG<br><img src="https://upload-images.jianshu.io/upload_images/12989993-96bcaf5716827e99?imageMogr2/auto-orient/strip%7CimageView2/2/w/657/format/webp" srcset="/img/loading.gif" alt="img"></p><p>åœ¨ airflow ä¸­è¿™ç§ DAG æ˜¯é€šè¿‡ç¼–å†™ Python ä»£ç æ¥å®ç°çš„ï¼ŒDAG çš„ç¼–å†™éå¸¸ç®€å•ï¼Œå®˜æ–¹æä¾›äº†å¾ˆå¤šçš„ä¾‹å­ï¼Œåœ¨å®‰è£…å®Œæˆåï¼Œå¯åŠ¨ webserver å³å¯çœ‹åˆ° DAG æ ·ä¾‹çš„æºç ï¼ˆå…¶å®å®šä¹‰äº† DAG å¯¹è±¡çš„ python ç¨‹åºï¼‰ï¼Œç¨åšä¿®æ”¹å³å¯æˆä¸ºè‡ªå·±çš„ DAG ã€‚ä¸Šå›¾ 1 ä¸­ DAG ä¸­çš„ä¾èµ–å…³ç³»é€šè¿‡ä¸‹è¿°ä¸‰è¡Œä»£ç å³å¯å®Œæˆï¼š<br><img src="https://upload-images.jianshu.io/upload_images/12989993-755318fef8cd6dd4?imageMogr2/auto-orient/strip%7CimageView2/2/w/766/format/webp" srcset="/img/loading.gif" alt="img"></p><h3 id="Operators-æ“ä½œç¬¦"><a href="#Operators-æ“ä½œç¬¦" class="headerlink" title="Operators-æ“ä½œç¬¦"></a>Operators-æ“ä½œç¬¦</h3><p>DAG å®šä¹‰ä¸€ä¸ªä½œä¸šæµï¼ŒOperators åˆ™å®šä¹‰äº†å®é™…éœ€è¦æ‰§è¡Œçš„ä½œä¸šã€‚airflow æä¾›äº†è®¸å¤š Operators æ¥æŒ‡å®šæˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„ä½œä¸šï¼š</p><ol><li>BashOperator - æ‰§è¡Œ bash å‘½ä»¤æˆ–è„šæœ¬ã€‚</li><li>SSHOperator - æ‰§è¡Œè¿œç¨‹ bash å‘½ä»¤æˆ–è„šæœ¬ï¼ˆåŸç†åŒ paramiko æ¨¡å—ï¼‰ã€‚</li><li>PythonOperator - æ‰§è¡Œ Python å‡½æ•°ã€‚</li><li>EmailOperator - å‘é€ Emailã€‚</li><li>HTTPOperator - å‘é€ä¸€ä¸ª HTTP è¯·æ±‚ã€‚</li><li>MySqlOperator, SqliteOperator, PostgresOperator, MsSqlOperator, OracleOperator, JdbcOperator, ç­‰. - æ‰§è¡Œ SQL ä»»åŠ¡ã€‚</li><li>DockerOperator, HiveOperator, S3FileTransferOperator, PrestoToMysqlOperator, SlackOperator ç­‰ã€‚</li></ol><p>é™¤äº†ä»¥ä¸Šè¿™äº› Operators è¿˜å¯ä»¥æ–¹ä¾¿çš„è‡ªå®šä¹‰ Operators æ»¡è¶³ä¸ªæ€§åŒ–çš„ä»»åŠ¡éœ€æ±‚ã€‚<br>åç»­ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨è¿™äº› Operatorsã€‚</p><h3 id="Timezone-æ—¶åŒº"><a href="#Timezone-æ—¶åŒº" class="headerlink" title="Timezone-æ—¶åŒº"></a>Timezone-æ—¶åŒº</h3><p>airflow 1.9 ä¹‹å‰çš„ç‰ˆæœ¬ä½¿ç”¨æœ¬åœ°æ—¶åŒºæ¥å®šä¹‰ä»»åŠ¡å¼€å§‹æ—¥æœŸï¼Œscheduler_interval ä¸­ crontab è¡¨è¾¾å¼ä¸­çš„å®šæ—¶ä¹Ÿæ˜¯ä¾æ®æœ¬åœ°æ—¶åŒºä¸ºå‡†ï¼Œä½† airflow 1.9 åŠåç»­æ–°ç‰ˆæœ¬å°†é»˜è®¤ä½¿ç”¨ UTC æ—¶åŒºæ¥ç¡®ä¿ airflow è°ƒåº¦çš„ç‹¬ç«‹æ€§ï¼Œä»¥é¿å…ä¸åŒæœºå™¨ä½¿ç”¨ä¸åŒæ—¶åŒºå¯¼è‡´è¿è¡Œé”™ä¹±ã€‚å¦‚æœè°ƒåº¦çš„ä»»åŠ¡é›†ä¸­åœ¨ä¸€ä¸ªæ—¶åŒºä¸Šï¼Œæˆ–ä¸åŒæœºå™¨ï¼Œä½†ä½¿ç”¨åŒä¸€æ—¶åŒºæ—¶ï¼Œéœ€è¦å¯¹ä»»åŠ¡çš„å¼€å§‹æ—¶é—´åŠ cron è¡¨è¾¾å¼è¿›è¡Œæ—¶åŒºè½¬æ¢ï¼Œæˆ–ç›´æ¥ä½¿ç”¨æœ¬åœ°æ—¶åŒºã€‚ç›®å‰ 1.9 çš„ç¨³å®šç‰ˆæœ¬è¿˜ä¸æ”¯æŒæ—¶åŒºé…ç½®ï¼Œåç»­ç‰ˆæœ¬ä¼šåŠ å…¥æ—¶åŒºé…ç½®ï¼Œä»¥æ»¡è¶³ä½¿ç”¨æœ¬åœ°æ—¶åŒºçš„éœ€æ±‚ã€‚</p><h3 id="Webserver-WebæœåŠ¡å™¨"><a href="#Webserver-WebæœåŠ¡å™¨" class="headerlink" title="Webserver-WebæœåŠ¡å™¨"></a>Webserver-WebæœåŠ¡å™¨</h3><p>webserver æ˜¯ airflow çš„ç•Œé¢å±•ç¤ºï¼Œå¯æ˜¾ç¤º DAG è§†å›¾ï¼Œæ§åˆ¶ä½œä¸šçš„å¯åœï¼Œæ¸…é™¤ä½œä¸šçŠ¶æ€é‡è·‘ï¼Œæ•°æ®ç»Ÿè®¡ï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼Œç®¡ç†ç”¨æˆ·åŠæ•°æ®è¿æ¥ç­‰ã€‚ä¸è¿è¡Œ webserver å¹¶ä¸å½±å“ airflow ä½œä¸šçš„è°ƒåº¦ã€‚</p><h3 id="Schduler-è°ƒåº¦å™¨"><a href="#Schduler-è°ƒåº¦å™¨" class="headerlink" title="Schduler-è°ƒåº¦å™¨"></a>Schduler-è°ƒåº¦å™¨</h3><p>è°ƒåº¦å™¨ schduler è´Ÿè´£è¯»å– DAG æ–‡ä»¶ï¼Œè®¡ç®—å…¶è°ƒåº¦æ—¶é—´ï¼Œå½“æ»¡è¶³è§¦å‘æ¡ä»¶æ—¶åˆ™å¼€å¯ä¸€ä¸ªæ‰§è¡Œå™¨çš„å®ä¾‹æ¥è¿è¡Œç›¸åº”çš„ä½œä¸šï¼Œå¿…é¡»æŒç»­è¿è¡Œï¼Œä¸è¿è¡Œåˆ™ä½œä¸šä¸ä¼šè·‘æ‰¹ã€‚</p><h3 id="Worker-å·¥ä½œèŠ‚ç‚¹"><a href="#Worker-å·¥ä½œèŠ‚ç‚¹" class="headerlink" title="Worker-å·¥ä½œèŠ‚ç‚¹"></a>Worker-å·¥ä½œèŠ‚ç‚¹</h3><p>å½“æ‰§è¡Œå™¨ä¸º CeleryExecutor æ—¶ï¼Œéœ€è¦å¼€å¯ä¸€ä¸ª workerã€‚</p><h3 id="Executor-æ‰§è¡Œå™¨"><a href="#Executor-æ‰§è¡Œå™¨" class="headerlink" title="Executor-æ‰§è¡Œå™¨"></a>Executor-æ‰§è¡Œå™¨</h3><p>æ‰§è¡Œå™¨æœ‰ SequentialExecutor, LocalExecutor, CeleryExecutor</p><ol><li>SequentialExecutor ä¸ºé¡ºåºæ‰§è¡Œå™¨ï¼Œé»˜è®¤ä½¿ç”¨ sqlite ä½œä¸ºçŸ¥è¯†åº“ï¼Œç”±äº sqlite æ•°æ®åº“çš„åŸå› ï¼Œä»»åŠ¡ä¹‹é—´ä¸æ”¯æŒå¹¶å‘æ‰§è¡Œï¼Œå¸¸ç”¨äºæµ‹è¯•ç¯å¢ƒï¼Œæ— éœ€è¦é¢å¤–é…ç½®ã€‚</li><li>LocalExecutor ä¸ºæœ¬æ‰§è¡Œå™¨ï¼Œä¸èƒ½ä½¿ç”¨ sqlite ä½œä¸ºçŸ¥è¯†åº“ï¼Œå¯ä»¥ä½¿ç”¨ mysql,postgress,db2,oracle ç­‰å„ç§ä¸»æµæ•°æ®åº“ï¼Œä»»åŠ¡ä¹‹é—´æ”¯æŒå¹¶å‘æ‰§è¡Œï¼Œå¸¸ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œéœ€è¦é…ç½®æ•°æ®åº“è¿æ¥ urlã€‚</li><li>CeleryExecutor ä¸º Celery æ‰§è¡Œå™¨ï¼Œéœ€è¦å®‰è£… Celery ,Celery æ˜¯åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„åˆ†å¸ƒå¼å¼‚æ­¥ä»»åŠ¡è°ƒåº¦å·¥å…·ã€‚éœ€è¦é¢å¤–å¯åŠ¨å·¥ä½œèŠ‚ç‚¹-workerã€‚ä½¿ç”¨ CeleryExecutor å¯å°†ä½œä¸šè¿è¡Œåœ¨è¿œç¨‹èŠ‚ç‚¹ä¸Šã€‚</li></ol><hr><h2 id="åŸºäºDockeræ­å»º"><a href="#åŸºäºDockeræ­å»º" class="headerlink" title="åŸºäºDockeræ­å»º"></a>åŸºäºDockeræ­å»º</h2><p>åŸºäºç¬¬ä¸‰æ–¹dockeré•œåƒè¿›è¡Œå®‰è£…ï¼Œgithub-repoï¼š<a href="https://github.com/puckel/docker-airflow" target="_blank" rel="noopener">https://github.com/puckel/docker-airflow</a></p><p>å‰æï¼šæœºå™¨å·²ç»è£…ä¸ŠdockeråŠdocker-composeå‘½ä»¤ï¼Œæœ¬é¡µé¢åŸºäºDockeræ­å»ºï¼Œéƒ¨ç½²airflowçš„CeleryExecutoræ¨¡å¼</p><ul><li><p>Step1 æ‹‰å–ä»£ç </p><pre><code class="shell">git clone https://github.com/puckel/docker-airflow.git</code></pre></li><li><p>Step2 ä¿®æ”¹ docker-compose-CeleryExecutor.ymlåŠDockerfile</p><pre><code>cd ~/docker-airflowvim docker-compose-CeleryExecutor.yml</code></pre><p>é»˜è®¤çš„composeæ˜¯æŠ“åŸæ¥ç‰ˆæœ¬çš„é•œåƒåŒ…ï¼Œæ”¹æˆlatestæ ‡ç­¾ï¼Œè¿™æ ·æ‰ä¼šä½¿ç”¨ç”¨Dockerfileæ„å»ºçš„é•œåƒ</p><p>ä¿®æ”¹webæš´éœ²ç«¯å£ï¼Œ8080å¯èƒ½è¢«å ç”¨ï¼Œä¸‹å›¾ä¿®æ”¹ä¸º8096ç«¯å£</p></li></ul><ul><li><p>Step3 Airflow Configè®¾ç½®</p><pre><code>cd configvim airflow.cfg</code></pre></li></ul><ul><li><p>æ„å»ºé•œåƒ</p><pre><code class="shell">docker build --rm -t puckel/docker-airflow:latest .docker-compose -f docker-compose-CeleryExecutor.yml up -d</code></pre></li></ul><p>å½“çœ‹åˆ°ä¸‹å›¾ï¼Œå°±ä»£è¡¨å·²ç»å¯åŠ¨ï¼Œå¯é€šè¿‡è¯¥ç«¯å£è¿›è¡Œè®¿é—®</p>]]></content>
    
    
    <categories>
      
      <category>etl</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>etl</tag>
      
      <tag>apache airflow</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Apache Nifiä½¿ç”¨æŒ‡å—</title>
    <link href="/2020/01/09/Apache-Nifi%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
    <url>/2020/01/09/Apache-Nifi%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</url>
    
    <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>Apache NiFiæ˜¯ä»€ä¹ˆï¼ŸNiFiå®˜ç½‘ç»™å‡ºå¦‚ä¸‹è§£é‡Šï¼šâ€œä¸€ä¸ªæ˜“ç”¨ã€å¼ºå¤§ã€å¯é çš„æ•°æ®å¤„ç†ä¸åˆ†å‘ç³»ç»Ÿâ€ã€‚é€šä¿—çš„æ¥è¯´ï¼Œå³Apache NiFi æ˜¯ä¸€ä¸ªæ˜“äºä½¿ç”¨ã€åŠŸèƒ½å¼ºå¤§è€Œä¸”å¯é çš„æ•°æ®å¤„ç†å’Œåˆ†å‘ç³»ç»Ÿï¼Œå…¶ä¸ºæ•°æ®æµè®¾è®¡ï¼Œå®ƒæ”¯æŒé«˜åº¦å¯é…ç½®çš„æŒ‡ç¤ºå›¾çš„æ•°æ®è·¯ç”±ã€è½¬æ¢å’Œç³»ç»Ÿä¸­ä»‹é€»è¾‘ã€‚</p><h2 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h2><p>å•èŠ‚ç‚¹æ¶æ„</p><p><img src="https://nifi.apache.org/docs/nifi-docs/html/images/zero-master-node.png" srcset="/img/loading.gif" alt="NiFi Architecture Diagram"></p><p>é›†ç¾¤æ¶æ„å›¾</p><p><img src="https://nifi.apache.org/docs/nifi-docs/html/images/zero-master-cluster.png" srcset="/img/loading.gif" alt="NiFi Cluster Architecture Diagram"></p><p><strong>web-sever</strong></p><p>å…¶ç›®çš„åœ¨äºæä¾›åŸºäºHTTPçš„å‘½ä»¤å’Œæ§åˆ¶APIã€‚</p><p><strong>Flow Controller</strong></p><p>è¿™æ˜¯æ“ä½œçš„æ ¸å¿ƒï¼Œä»¥Processorä¸ºå¤„ç†å•å…ƒï¼Œæä¾›äº†ç”¨äºè¿è¡Œçš„æ‰©å±•çº¿ç¨‹ï¼Œå¹¶ç®¡ç†æ‰©å±•æ¥æ”¶èµ„æºæ—¶çš„è°ƒåº¦ã€‚</p><p><strong>Extensions</strong></p><p>åœ¨å…¶ä»–æ–‡æ¡£ä¸­æè¿°äº†å„ç§ç±»å‹çš„NiFiæ‰©å±•ï¼ŒExtensionsçš„å…³é”®åœ¨äºæ‰©å±•åœ¨JVMä¸­æ“ä½œå’Œæ‰§è¡Œã€‚</p><p><strong>FlowFile Repository</strong></p><p>FlowFileåº“çš„ä½œç”¨æ˜¯NiFiè·Ÿè¸ªè®°å½•å½“å‰åœ¨æµä¸­å¤„äºæ´»åŠ¨çŠ¶æ€çš„ç»™å®šæµæ–‡ä»¶çš„çŠ¶æ€ï¼Œå…¶å®ç°æ˜¯å¯æ’æ‹”çš„ï¼Œé»˜è®¤çš„æ–¹æ³•æ˜¯ä½äºæŒ‡å®šç£ç›˜åˆ†åŒºä¸Šçš„ä¸€ä¸ªæŒä¹…çš„å†™å‰æ—¥å¿—ã€‚FlowFileåº“çš„ä½œç”¨æ˜¯NiFiè·Ÿè¸ªè®°å½•å½“å‰åœ¨æµä¸­å¤„äºæ´»åŠ¨çŠ¶æ€çš„ç»™å®šæµæ–‡ä»¶çš„çŠ¶æ€ï¼Œå…¶å®ç°æ˜¯å¯æ’æ‹”çš„ï¼Œé»˜è®¤çš„æ–¹æ³•æ˜¯ä½äºæŒ‡å®šç£ç›˜åˆ†åŒºä¸Šçš„ä¸€ä¸ªæŒä¹…çš„å†™å‰æ—¥å¿—ã€‚</p><p><strong>Content Repository</strong></p><p>Contentåº“çš„ä½œç”¨æ˜¯ç»™å®šæµæ–‡ä»¶çš„å®é™…å†…å®¹å­—èŠ‚æ‰€åœ¨çš„ä½ç½®ï¼Œå…¶å®ç°ä¹Ÿæ˜¯å¯æ’æ‹”çš„ã€‚é»˜è®¤çš„æ–¹æ³•æ˜¯ä¸€ç§ç›¸å¯¹ç®€å•çš„æœºåˆ¶ï¼Œå³åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­å­˜å‚¨æ•°æ®å—ã€‚</p><p><strong>Provenance Repository</strong></p><p>Provenanceåº“æ˜¯æ‰€æœ‰æºæ•°æ®å­˜å‚¨çš„åœ°æ–¹ï¼Œæ”¯æŒå¯æ’æ‹”ã€‚é»˜è®¤å®ç°æ˜¯ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªç‰©ç†ç£ç›˜å·ï¼Œåœ¨æ¯ä¸ªä½ç½®äº‹ä»¶æ•°æ®éƒ½æ˜¯ç´¢å¼•å’Œå¯æœç´¢çš„ã€‚</p><h2 id="dockeréƒ¨ç½²"><a href="#dockeréƒ¨ç½²" class="headerlink" title="dockeréƒ¨ç½²"></a>dockeréƒ¨ç½²</h2><p>nifiéœ€è¦é€šè¿‡é›†ç¾¤å®ç°å¤šç§Ÿæˆ·ï¼Œåœ¨standaloneæ¨¡å¼ä¸‹ï¼Œå¯ä»¥é€šè¿‡dockerå¯åŠ¨å¤šä¸ªå®ä¾‹æ¥å®ç°å¤šç”¨æˆ·é€šè¿‡ä¸åŒç«¯å£è®¿é—®å„è‡ªçš„nifi</p><pre><code class="shell">docker run --name nifi01 \  --restart=always \  -p 8090:8080 \  -p 10000:10000 \  -v /data/nifi:/data/nifi/ \  -d \  apache/nifi:latest  docker run --name nifi02 \  --restart=always \  -p 8094:8080 \  -p 10001:10000 \  -v /data/nifi02:/data/nifi02/ \  -d \  apache/nifi:latest</code></pre><p>å¯åŠ¨nifiï¼Œåœæ­¢nifi</p><pre><code class="shell">docker start nifidocker stop nifi</code></pre><h2 id="NiFi-Processor"><a href="#NiFi-Processor" class="headerlink" title="NiFi Processor"></a>NiFi Processor</h2><p>Flow Controlleræ˜¯NiFiçš„æ ¸å¿ƒï¼ŒFlow Controlleræ‰®æ¼”è€…æ–‡ä»¶äº¤æµçš„å¤„ç†å™¨è§’è‰²ï¼Œç»´æŒç€å¤šä¸ªå¤„ç†å™¨çš„è¿æ¥å¹¶ç®¡ç†å„ä¸ªProcesserï¼ŒProcessoråˆ™æ˜¯å®é™…å¤„ç†å•å…ƒã€‚</p><p><img src="/.com//processor.png" srcset="/img/loading.gif" alt="1572501106736"></p><p>ProcessoråŒ…å«å„ç§ç±»å‹çš„ç»„ä»¶ï¼Œå¦‚amazonã€attributesã€hadoopç­‰ï¼Œå¯é€šè¿‡å‰ç¼€è¿›è¡Œè½»æ˜“è¾¨è¯†ï¼Œå¦‚Getã€Fetchå¼€å¤´ä»£è¡¨è·å–ï¼Œå¦‚getFileã€getFTPã€FetchHDFSï¼Œexecuteä»£è¡¨æ‰§è¡Œï¼Œå¦‚ExecuteSQLã€ExecuteProcessã€ExecuteFlumeSinkç­‰å‡å¯è¾ƒå®¹æ˜“çŸ¥å…¶ç®€å•ç”¨é€”ã€‚å³è¾¹é€‰æ‹©hadoopåˆ™ä¼šæ˜¾ç¤ºæ‰€æœ‰hadoopç›¸å…³çš„processorï¼Œå¦‚å›¾æ‰€ç¤º</p><p><img src="/.com//hadoop.png" srcset="/img/loading.gif" alt="1572501279158"></p><p>ä¸hadoopç›¸å…³çš„processoræœ‰è¯»å†™HDFSæ–‡ä»¶ï¼Œå†™Hbaseï¼Œè¯»å†™parquetæ–‡ä»¶ç­‰</p><h2 id="Nifiå®æˆ˜Demo"><a href="#Nifiå®æˆ˜Demo" class="headerlink" title="Nifiå®æˆ˜Demo"></a>Nifiå®æˆ˜Demo</h2><h3 id="é€šè¿‡Nifiå®ç°æŠŠæŒ‡å®šæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ç§»åŠ¨åˆ°å¦ä¸€ä¸ªæ–‡ä»¶å¤¹"><a href="#é€šè¿‡Nifiå®ç°æŠŠæŒ‡å®šæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ç§»åŠ¨åˆ°å¦ä¸€ä¸ªæ–‡ä»¶å¤¹" class="headerlink" title="é€šè¿‡Nifiå®ç°æŠŠæŒ‡å®šæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ç§»åŠ¨åˆ°å¦ä¸€ä¸ªæ–‡ä»¶å¤¹"></a>é€šè¿‡Nifiå®ç°æŠŠæŒ‡å®šæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ç§»åŠ¨åˆ°å¦ä¸€ä¸ªæ–‡ä»¶å¤¹</h3><ul><li><p>step 1é€‰å–processor</p><p>é€‰å–getfileåŠputfileçš„processï¼Œå¹¶è¿æ¥</p><p><a href="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/geifile.png" target="_blank" rel="noopener"><img src="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/scaled-840-0/geifile.png" srcset="/img/loading.gif" alt="geifile.png"></a></p></li></ul><p><a href="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/flow.png" target="_blank" rel="noopener"><img src="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/scaled-840-0/flow.png" srcset="/img/loading.gif" alt="flow.png"></a></p><ul><li><p>step 2 å¡«å†™getfileåŠputfileç›¸å…³å±æ€§</p><p>åŒå‡»getfileæˆ–è€…putfileçš„processorï¼Œpropertyä¸­å¡«å†™æºæ•°æ®æ–‡ä»¶å¤¹åŠç›®æ ‡æ–‡ä»¶å¤¹ï¼Œå…¶ä»–å‚æ•°æŒ‰éœ€è¿›è¡Œé…ç½®ï¼Œæ­¤demoæŒ‰ç…§é»˜è®¤å‚æ•°å¡«å†™ï¼Œå¯¹äºputfile processorä¸­çš„settingæ ï¼Œè®¾ç½®å‹¾é€‰è‡ªåŠ¨ç»ˆæ­¢ç­–ç•¥ï¼Œå½“putfileå¤±è´¥æˆ–è€…æˆåŠŸçš„æ—¶å€™å°±åœæ­¢æ­¤processor</p><p><a href="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/properties.png" target="_blank" rel="noopener"><img src="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/scaled-840-0/properties.png" srcset="/img/loading.gif" alt="properties.png"></a></p></li></ul><p><a href="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/putfile.png" target="_blank" rel="noopener"><img src="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/scaled-840-0/putfile.png" srcset="/img/loading.gif" alt="putfile.png"></a></p><p><a href="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/putfile_config.png" target="_blank" rel="noopener"><img src="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/scaled-840-0/putfile_config.png" srcset="/img/loading.gif" alt="putfile_config.png"></a></p><ul><li><p>step 3 å¯åŠ¨</p><p>ç©ºç™½å¤„å³é”®é€‰æ‹©startï¼ŒçŠ¶æ€æ æ˜¾ç¤ºç»¿è‰²ä»£è¡¨processoråœ¨æ‰§è¡Œï¼Œå‡å¦‚/data/nifi/inputæœ‰æ–‡ä»¶æ­¤æ—¶å¼€å¯å·¥ä½œæµå/data/nifi/inputå¯¹åº”ä¹Ÿä¼šæœ‰è¯¥æ–‡ä»¶</p></li></ul><p><a href="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/start.png" target="_blank" rel="noopener"><img src="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/scaled-840-0/start.png" srcset="/img/loading.gif" alt="start.png"></a></p><h3 id="æ•°æ®åº“è¡¨å’Œè¡¨åŒæ­¥"><a href="#æ•°æ®åº“è¡¨å’Œè¡¨åŒæ­¥" class="headerlink" title="æ•°æ®åº“è¡¨å’Œè¡¨åŒæ­¥"></a>æ•°æ®åº“è¡¨å’Œè¡¨åŒæ­¥</h3><p>è¡¨åˆ°è¡¨çš„åŒæ­¥,NIFIé»˜è®¤sqlæŸ¥è¯¢å‡ºæ¥çš„æ•°æ®ä¸ºAvroæ ¼å¼,æ‰€ä»¥éœ€è¦å…ˆå°†Avroæ ¼å¼è½¬åŒ–ä¸ºjsonæ ¼å¼,å†å°†jsonè½¬æ¢ä¸ºsqlè¯­å¥,æœ€åä½¿ç”¨PUTSQLå¤„ç†å™¨å°†æ•°æ®å­˜å…¥æ•°æ®åº“ã€‚éœ€è¦ç”¨åˆ°ExecuteorSQLã€ConvertAvroToJSONã€ConvertJSONToSQLã€PUTSQLå››ç§å¤„ç†å™¨ã€‚<br><a href="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/table2table.png" target="_blank" rel="noopener"><img src="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/scaled-840-0/table2table.png" srcset="/img/loading.gif" alt="table2table.png"></a> </p><ul><li>step 1 ä½¿ç”¨ExecuteSQLé…ç½®æ•°æ®æº<br>ä»Components ToolBarä¸Šå°†processoræ‹–æ‹½åˆ°ç”»å¸ƒä¸Šï¼Œé€‰æ‹©ExecuteSQLå¤„ç†å™¨ï¼Œå³é”®æˆ–åŒå‡»è¯¥å¤„ç†å™¨ç¼–è¾‘propertiesã€‚è¯¥å¤„ç†å™¨åŸç”Ÿæä¾›ä¸‰ç§æ•°æ®åº“è¿æ¥æ± ï¼Œæä¾›äº†å¤§å¤šæ•°æ•°æ®åº“é©±åŠ¨ï¼Œå¦å¤–è¿˜å¯ä»¥è‡ªå®šä¹‰è¿æ¥æ± çš„åç§°ã€‚<br><a href="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/ExecuteSQL.png" target="_blank" rel="noopener"><img src="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/scaled-840-0/ExecuteSQL.png" srcset="/img/loading.gif" alt="ExecuteSQL.png"></a><ul><li>Database Connection Pooling Service æä¾›æ•°æ®åº“è¿æ¥æ± æœåŠ¡  </li><li>postgresqlé©±åŠ¨ç¨‹åº<a href="https://jdbc.postgresql.org/download.html" target="_blank" rel="noopener">ä¸‹è½½</a><br><a href="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/driverConfig.png" target="_blank" rel="noopener"><img src="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/scaled-840-0/driverConfig.png" srcset="/img/loading.gif" alt="driverConfig.png"></a></li><li>é©±åŠ¨é…ç½®å®Œæˆåç‚¹å‡»âš¡,ä½¿èƒ½åæŸ¥çœ‹æ˜¯å¦æŠ¥é”™  </li></ul></li><li>step 2 ä½¿ç”¨ConvertAvroToJSONå°†Avroæ ¼å¼è½¬æ¢ä¸ºjsonæ ¼å¼<br><a href="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/ConvertAvroToJSON.png" target="_blank" rel="noopener"><img src="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/scaled-840-0/ConvertAvroToJSON.png" srcset="/img/loading.gif" alt="ConvertAvroToJSON.png"></a></li><li>step 3 ä½¿ç”¨ConvertJSONToSQLå°†jsonæ•°æ®è½¬æ¢ä¸ºSQLè¯­å¥<br><a href="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/ConvertJSONToSQL.png" target="_blank" rel="noopener"><img src="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/scaled-840-0/ConvertJSONToSQL.png" srcset="/img/loading.gif" alt="ConvertJSONToSQL.png"></a> </li><li>step 4 ä½¿ç”¨PUTSQLå°†æ•°æ®å­˜å…¥åˆ°æ•°æ®åº“ï¼Œé…ç½®å®Œæˆåæ•°æ®æµå¯åŠ¨åå¯ä»¥çœ‹åˆ°æ•°æ®æµåŠ¨è¿‡ç¨‹ï¼Œå†åˆ°æ•°æ®åº“ä¸­éªŒè¯ç»“æœã€‚<br><a href="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/PUTSQL.png" target="_blank" rel="noopener"><img src="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/scaled-840-0/PUTSQL.png" srcset="/img/loading.gif" alt="PUTSQL.png"></a></li></ul><p><strong>Tips:åŸºæœ¬æ¡ˆä¾‹è·‘é€šåå¯ä»¥åœ¨Operateæ createTemplate,å¯ä»¥åœ¨webé¡µé¢ç›´æ¥å¯¼å‡ºxmlæ ¼å¼çš„æ•°æ®å¤„ç†æµç¨‹é‡å¤ä½¿ç”¨å‡å°‘é…ç½®æ—¶é—´ã€‚</strong>  </p><h2 id="Trouble-Shooting"><a href="#Trouble-Shooting" class="headerlink" title="Trouble Shooting"></a>Trouble Shooting</h2><ul><li>åŸå§‹æ–‡ä»¶å¤¹æˆ–è€…ç›®æ ‡æ–‡ä»¶å¤¹æ²¡æœ‰æƒé™ï¼Œprocesså³ä¸Šè§’ä¼šæ˜¾ç¤ºæŠ¥é”™ä¿¡æ¯ï¼Œæ­¤æ—¶åº”è¯¥å°†æ–‡ä»¶å¤¹è®¾ç½®å¯¹åº”æƒé™ï¼Œå°†æ‹¥æœ‰è€…æ”¹ä¸ºnifiç”¨æˆ·ï¼Œæ­¤å‘½ä»¤åº”è¯¥ç”¨rootæƒé™æ‰§è¡Œï¼Œè‹¥nifiåœ¨dockerä¸­ï¼Œåº”è¯¥åˆ°ä½¿ç”¨rootç”¨æˆ·ç™»å½•åˆ°å¯¹åº”containeræ‰§è¡Œ</li></ul><pre><code>linuxç‰ˆæœ¬sudo chown -R nifi:nifi /data/nifi/inputsudo chown -R nifi:nifi /data/nifi/outputdockerç‰ˆæœ¬docker exec -it -u root nifi /bin/bashchown -R nifi:nifi /data/nifi/inputchown -R nifi:nifi /data/nifi/output</code></pre><p>æŠ¥é”™ä¿¡æ¯ï¼š</p><p><a href="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/error.png" target="_blank" rel="noopener"><img src="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/scaled-840-0/error.png" srcset="/img/loading.gif" alt="error.png"></a></p><ul><li>putfileæˆ–è€…getfileçš„propertieså¡«å†™é”™è¯¯çš„æ—¶å€™ï¼Œå¯¹åº”processorä¸Šé¢ä¼šæ˜¾ç¤ºæ„Ÿå¹å·ï¼ŒæŒ‰ç…§æç¤ºä¿®æ”¹å³å¯ï¼Œå¦‚getfileä¸­æºæ–‡ä»¶å¤¹ä¸º/data/nifi/input01ï¼Œç³»ç»Ÿä¸­æ²¡æœ‰æ­¤æ–‡ä»¶å¤¹ï¼Œåˆ™ä¼šæ˜¾ç¤ºå¯¹åº”æç¤ºä¿¡æ¯</li></ul><p><a href="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/error01.png" target="_blank" rel="noopener"><img src="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/scaled-840-0/error01.png" srcset="/img/loading.gif" alt="error01.png"></a></p>]]></content>
    
    
    <categories>
      
      <category>etl</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>apache nifi</tag>
      
      <tag>etl</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Spark run on K8s</title>
    <link href="/2020/01/09/Spark-run-on-K8s/"/>
    <url>/2020/01/09/Spark-run-on-K8s/</url>
    
    <content type="html"><![CDATA[<h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><p>é¦–å…ˆæŸ¥çœ‹äº†ä¸‹sparkçš„å®˜æ–¹æ–‡æ¡£ï¼Œäº†è§£äº†sparkæ€ä¹ˆåœ¨k8sä¸Šé¢è·‘çš„ï¼Œå®é™…ä¸Šä¸éœ€è¦æ­å»ºsparké›†ç¾¤ï¼Œæäº¤ä½œä¸šåˆ°k8sçš„api serverå³å¯ã€‚çœ‹ä¼¼ç®€å•ä½†æ˜¯è¿˜æ˜¯ä¸çŸ¥é“æ€ä¹ˆåŠ¨æ‰‹å®è·µã€‚äºæ˜¯youtubeä¸Šé¢æœäº†ä¸‹ç›¸å…³è§†é¢‘ï¼ŒæŒ‰ç…§è§†é¢‘å¾ˆå¿«å°±å®è·µäº†ä¸€æŠŠspark run on k8sï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>step 1 åˆ°k8-masteræœºå™¨ä¸‹è½½äºŒè¿›åˆ¶sparkæœ€æ–°äºŒè¿›åˆ¶å®‰è£…åŒ…ï¼Œå¹¶è§£å‹</li></ul><pre><code class="shell">cd /optwget http://mirrors.tuna.tsinghua.edu.cn/apache/spark/spark-2.4.4/spark-2.4.4-bin-hadoop2.7.tgztar -zxvf http://mirrors.tuna.tsinghua.edu.cn/apache/spark/spark-2.4.4/spark-2.4.4-bin-hadoop2.7.tgz</code></pre><ul><li>step 2 åˆ¶ä½œsparkçš„dockeré•œåƒ</li></ul><pre><code class="shell">cd spark-2.4.4-bin-hadoop2.7./bin/docker-image-tool.sh -r chenlianguu -t v2.4.4 build  # åˆ¶ä½œsparkè¿›è¡Œ./bin/docker-image-tool.sh -r chenlianguu -t v2.4.4 push  #å°†sparké•œåƒæ¨é€åˆ°docker hubdocker images[root@k8s-master opt]# docker imagesREPOSITORY                                                        TAG                 IMAGE ID            CREATED             SIZEchenliang/spark-r                                                 v2.4.4              6479a523e3f7        20 hours ago        759MB</code></pre><ul><li>step 3 æäº¤ä½œä¸šåˆ°k8s</li></ul><p>åœ¨æäº¤sparkçš„ä½œä¸šçš„æœºå™¨ä¸Šï¼ŒæŠŠapi serverçš„proxyæ‰“å¼€</p><pre><code class="shell">kubectl proxy</code></pre><pre><code class="shell">./bin/spark-submit \--master k8s://http://127.0.0.1:8001 \--name spark-pi \--deploy-mode cluster \--class org.apache.spark.examples.SparkPi \--conf spark.executor.instances=3 \--conf spark.kubernetes.container.image=chenlianguu/spark-r:v2.4.4 \/opt/spark-2.4.4-bin-hadoop2.7/examples/jars/spark-examples_2.11-2.4.4.jar</code></pre><h2 id="è¿è¡Œè¯´æ˜"><a href="#è¿è¡Œè¯´æ˜" class="headerlink" title="è¿è¡Œè¯´æ˜"></a>è¿è¡Œè¯´æ˜</h2><p><a href="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/k8s-cluster-mode.png" target="_blank" rel="noopener"><img src="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/scaled-840-0/k8s-cluster-mode.png" srcset="/img/loading.gif" alt="k8s-cluster-mode.png"></a><br>é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œé€šè¿‡spark-submitæäº¤ç¨‹åºåˆ°k8sé›†ç¾¤ï¼Œå…·ä½“ä¸€ä¸‹æ­¥éª¤ï¼š  </p><ul><li>é€šè¿‡k8såˆ›å»ºspark driverç«¯çš„pod</li><li>driverç«¯åœ¨k8så…¶ä»–èŠ‚ç‚¹åˆ›å»ºexecutorç«¯çš„podå¹¶ä¿æŒé€šä¿¡ï¼Œexecutorå…·ä½“æ‰§è¡Œä»£ç ï¼Œè¿™é‡Œè®¾è®¡åˆ°æƒé™é—®é¢˜ï¼Œå‡å¦‚æ²¡æœ‰å¯¹åº”çš„æƒé™åˆ›å»ºpodsï¼Œæ‰§è¡Œsparkä¼šæŠ¥é”™ï¼Œå…·ä½“è§trouble  shootingç¬¬äºŒç‚¹</li><li>å½“ç¨‹åºè·‘å®Œäº†ï¼Œexecutorç«¯podä¼šç»ˆæ­¢å¹¶æ¸…ç†ï¼Œdriverç«¯çš„podä¼šä¿æŒcompleteçŠ¶æ€å¹¶æŒä¹…åŒ–logä¿¡æ¯ï¼Œæœ€åä¼šç”±k8s api serverè¿›è¡Œdriverç«¯podçš„åƒåœ¾å›æ”¶å·¥ä½œ</li></ul><h2 id="trouble-shooting"><a href="#trouble-shooting" class="headerlink" title="trouble shooting"></a>trouble shooting</h2><p>è·‘spark on k8sçš„pi exampleç¢°åˆ°çš„ä¸€äº›å‘åŠè§£å†³æ–¹æ¡ˆ</p><ul><li>æ‰¾ä¸åˆ°jaré—®é¢˜<br><img src="https://i.loli.net/2020/01/09/xzqUmBIuCdP6HlW.jpg" srcset="/img/loading.gif" alt="1"><br><img src="https://i.loli.net/2020/01/09/U6uIFOrgcjQAkn4.jpg" srcset="/img/loading.gif" alt="2"><br>ä¹‹å‰æäº¤çš„è„šæœ¬æ˜¯è¿™æ ·çš„  </li></ul><pre><code class="shell">./bin/spark-submit \--master k8s://http://127.0.0.1:8001 \--name spark-pi \--deploy-mode cluster \--class org.apache.spark.examples.SparkPi \--conf spark.executor.instances=3 \--conf spark.kubernetes.container.image=chenlianguu/spark-r:v2.4.4 \/opt/spark-2.4.4-bin-hadoop2.7/examples/jars/spark-examples_2.11-2.4.4.jar</code></pre><p>å…¶ä¸­jaråŒ…åˆ¶å®šçš„åœ°å€æ˜¯localï¼Œè·¯å¾„å¡«å†™åº”è¯¥åŠ ä¸Šåè®®local:///opt/spark-2.4.4-bin-hadoop2.7/examples/jars/spark-examples_2.11-2.4.4.jarï¼ŒåŠ ä¸Šä¹‹åè¿˜æ˜¯æŠ¥åŒæ ·çš„é”™ï¼Œgoogleåå‘ç°jaråŒ…å®é™…ä¸Šæ˜¯åœ¨jaråŒ…åœ¨dockeré•œåƒé‡Œé¢çš„åœ°å€ï¼Œå› æ­¤æ”¹ä¸ºlocal:///opt/spark/examples/jars/spark-examples_2.11-2.4.4.jar   </p><ul><li>jaré—®é¢˜è§£å†³äº†ï¼Œåˆå¼€å§‹æŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹<br><img src="https://i.loli.net/2020/01/09/BgsviowCp5EzARG.jpg" srcset="/img/loading.gif" alt="3"><br>ç¬¬ä¸€æ„Ÿè§‰å°±æ˜¯æƒé™é—®é¢˜ï¼Œç½‘ä¸Šæ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆï¼Œrefï¼š<a href="https://github.com/GoogleCloudPlatform/continuous-deployment-on-kubernetes/issues/113" target="_blank" rel="noopener">è§£å†³åŠæ³•</a>ï¼ŒæŒ‰ç…§è¿™ä¸ªæ€è·¯ï¼Œåœ¨k8s-masterèŠ‚ç‚¹ï¼Œè¾“å…¥   <pre><code>kubectl create clusterrolebinding default --clusterrole cluster-admin --serviceaccount=default:default</code></pre></li></ul><p>ç„¶åç»§ç»­æ‰§è¡Œspark-submitè„šæœ¬ï¼Œå¯ä»¥é¡ºåˆ©å¯åŠ¨driverç«¯ï¼Œä½†æ˜¯æœ‰2ä¸ªexecutorç«¯è¿˜æ˜¯æŠ¥é”™ï¼Œè¯´æ˜¯èµ„æºä¸å¤Ÿï¼Œæœ‰ä¸€ä¸ªexecutorç«¯æ‰§è¡ŒæˆåŠŸï¼Œæ•´ä¸ªjobè¿˜æ˜¯é¡ºåˆ©çš„è·‘ä¸‹æ¥äº†ï¼ŒæŸ¥çœ‹driverç«¯æ—¥å¿—ã€‚kubectl logs podsname </p><h2 id><a href="#" class="headerlink" title></a><img src="https://i.loli.net/2020/01/09/5bWGKh34DqVQfYU.jpg" srcset="/img/loading.gif" alt="5"></h2><p>å‚è€ƒèµ„æ–™ï¼š<br><a href="https://spark.apache.org/docs/latest/running-on-kubernetes.html" target="_blank" rel="noopener">sparkå®˜æ–¹doc</a><br><a href="https://www.youtube.com/watch?v=l7UoE97Z24I&list=LL-3gJZTnF4DbSyb7KID7P7g&index=2&t=0s" target="_blank" rel="noopener">youtubeåŠ¨æ‰‹è§†é¢‘</a></p>]]></content>
    
    
    <categories>
      
      <category>kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kubernetes</tag>
      
      <tag>å¤§æ•°æ®</tag>
      
      <tag>éƒ¨ç½²</tag>
      
      <tag>spark</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kuberneteséƒ¨ç½²</title>
    <link href="/2020/01/09/Kubernetes%E9%83%A8%E7%BD%B2/"/>
    <url>/2020/01/09/Kubernetes%E9%83%A8%E7%BD%B2/</url>
    
    <content type="html"><![CDATA[<p>k8sçš„æ­å»ºä¸»è¦æœ‰ä¸‰ç§æ–¹å¼ï¼škubeadminå®‰è£…ã€dockerå®‰è£…åŠäºŒè¿›åˆ¶å®‰è£…ï¼Œå…¶ä¸­äºŒè¿›åˆ¶å®‰è£…æ–¹å¼æœ€ä¸ºå¤æ‚éœ€è¦éƒ¨ç½²äººå‘˜äº†è§£ç½‘ç»œhttpsï¼Œcaè¯ä¹¦ç­‰æ–¹é¢çš„çŸ¥è¯†ï¼Œkubeadminå®‰è£…æ–¹å¼å¤§å¤§ç®€åŒ–äº†éƒ¨ç½²æ“ä½œï¼Œåˆšå…¥é—¨å»ºè®®å°è¯•kubeadminæ–¹å¼å®‰è£…ã€‚dockerå®‰è£…æˆ‘å¹¶ä¸è§‰å¾—åˆé€‚ï¼Œæœ¬èº«k8sä½œä¸ºå®¹å™¨ç¼–æ’ç³»ç»Ÿéƒ¨ç½²åœ¨dockeré‡Œé¢ï¼Œç½‘ç»œåŠç›¸å…³ç«¯å£é…ç½®è¾ƒä¸ºå¤æ‚ï¼Œä¸ºäº†é¿å…åŸ‹ä¸‹å¤ªå¤šçš„å‘ï¼Œæœ¬äººæ²¡æœ‰å°è¯•è¿™ç§æ–¹å¼è¿›è¡Œå®‰è£…ã€‚</p><p>å…·ä½“å®‰è£…éƒ¨ç½²æˆ‘å°±ä¸å†™åœ¨è¿™é‡Œäº†ï¼Œåˆ†äº«ä¸€å¥—è‡ªå·±çœ‹çš„k8så…¥é—¨è§†é¢‘ï¼Œå¾ˆç®€çŸ­èƒ½å¤Ÿå¿«é€Ÿäº†è§£k8sï¼Œå½“æ—¶k8så­¦ä¹ æ›²çº¿æ˜¯æ¯”è¾ƒé™¡å³­çš„ã€‚</p><p>ğŸ‘‰ğŸ»<a href="https://pan.baidu.com/s/1ieZmpZdsae73PacD9FZDYA" target="_blank" rel="noopener">ç™¾åº¦äº‘ç›˜</a> å¯†ç :amlo</p><p>ğŸ‘‰ğŸ»<a href="https://alevelhome-my.sharepoint.com/:w:/p/chenliang/EbQBPVmKj7VBpKZGYo02h4YBGbutlFV-28jq86GsR76HzQ?e=SgE4o5" target="_blank" rel="noopener">å®‰è£…éƒ¨ç½²æ–‡æ¡£</a>  </p><p>æŒ‰ç…§æ­¤æ–‡æ¡£éƒ¨ç½²åŸºæœ¬æ²¡å•¥å‘ï¼Œæ³¨æ„çš„æ˜¯éƒ¨åˆ†é•œåƒåœ¨å›½å¤–æœåŠ¡å™¨ï¼Œéœ€è¦æ›¿æ¢æˆæ–‡æ¡£ä½œè€…å›½å†…çš„é•œåƒå³å¯ã€‚</p><hr><p>æœ€è¿‘çœ‹åˆ°æ–°çš„å·¥å…·rancherï¼Œä¼ä¸šçº§ç®¡ç†è¿ç»´kubernetesé›†ç¾¤çš„å¥½å·¥å…·çš„ã€‚åç»­ç»§ç»­æ›´æ–°</p>]]></content>
    
    
    <categories>
      
      <category>kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kubernetes</tag>
      
      <tag>éƒ¨ç½²</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Dockeréƒ¨ç½²ä¼ªåˆ†å¸ƒå¼å¤§æ•°æ®ç¯å¢ƒ</title>
    <link href="/2020/01/09/Docker%E9%83%A8%E7%BD%B2%E4%BC%AA%E5%88%86%E5%B8%83%E5%BC%8F%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%8E%AF%E5%A2%83/"/>
    <url>/2020/01/09/Docker%E9%83%A8%E7%BD%B2%E4%BC%AA%E5%88%86%E5%B8%83%E5%BC%8F%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%8E%AF%E5%A2%83/</url>
    
    <content type="html"><![CDATA[<h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>é€šè¿‡dockeræ­å»ºå¤§æ•°æ®ç¯å¢ƒ  </p><ul><li>å¼€ç®±å³ç”¨ï¼Œä¸å¸¸é©»åå°ï¼Œéœ€è¦çš„æ—¶å€™å¯åŠ¨é›†ç¾¤å³å¯ï¼Œä¸ç”¨çš„æ—¶å€™å…³é—­é›†ç¾¤é‡Šæ”¾æœºå™¨èµ„æº</li><li>é¿å…äº†ç›´æ¥å®‰è£…ç«¯å£å ç”¨é—®é¢˜ï¼Œå¤§æ•°æ®å¹³å°æ‰€éœ€ç«¯å£è¾ƒå¤š</li><li>sparkèµ„æºdockeråŒ–ï¼Œä¾¿äºåæœŸk8sè¿›è¡Œèµ„æºç®¡ç†è°ƒåº¦</li></ul><p>ä¸Šè¿°å¥½å¤„ä¸»è¦æ˜¯åŸºäºæµ‹è¯•ç¯å¢ƒä¸‹ï¼ŒåŸºäºç”Ÿäº§ç¯å¢ƒçš„å¤§æ•°æ®å¹³å°åŒ–è¦è€ƒè™‘çš„ç‚¹å¾ˆå¤šï¼Œä¾‹å¦‚åæœŸæ‰©å®¹ã€è¿ç»´ã€å®‰å…¨ç­‰å› ç´ ï¼Œå¤§æ•°æ®å¹³å°æ•´ä¸ªæ˜¯å¦dockeråŒ–åæœŸæœ‰å¾…è€ƒè¯ã€‚</p><h2 id="é•œåƒåˆ¶ä½œæ–¹æ¡ˆ"><a href="#é•œåƒåˆ¶ä½œæ–¹æ¡ˆ" class="headerlink" title="é•œåƒåˆ¶ä½œæ–¹æ¡ˆ"></a>é•œåƒåˆ¶ä½œæ–¹æ¡ˆ</h2><p>ä½¿ç”¨Dockeræ¥æ­å»ºhadoop,sparkåŠmysqlçš„é›†ç¾¤ï¼Œé¦–å…ˆä½¿ç”¨Dockerfileåˆ¶ä½œé•œåƒï¼ŒæŠŠç›¸å…³çš„è½¯ä»¶æ‹·è´åˆ°çº¦å®šå¥½çš„ç›®å½• ä¸‹ï¼ŒæŠŠé…ç½®æ–‡ä»¶åœ¨å¤–é¢å…ˆé…ç½®å¥½ï¼Œå†æ‹·è´ç§»åŠ¨åˆ°hadoop,sparkçš„é…ç½®ç›®å½•ï¼Œä¸ºäº†èƒ½ä½¿å¾—mysqlèƒ½ä»å…¶å®ƒèŠ‚ç‚¹è¢«è®¿é—®åˆ°ï¼Œè¦é…ç½®mysqlçš„è®¿é—®æƒé™ã€‚</p><h2 id="æ•´ä½“æ¶æ„"><a href="#æ•´ä½“æ¶æ„" class="headerlink" title="æ•´ä½“æ¶æ„"></a>æ•´ä½“æ¶æ„</h2><p>ä¸€å…±3ä¸ªèŠ‚ç‚¹ï¼Œå³å¯åŠ¨3ä¸ªå®¹å™¨ã€‚hadoop-master,hadoop-node1,hadoop-node2è¿™ä¸‰ä¸ªå®¹å™¨é‡Œé¢å®‰è£…hadoopå’Œsparké›†ç¾¤ã€‚<br><img src="https://i.loli.net/2020/01/09/HIAsFMrPekj4fZw.png" srcset="/img/loading.gif" alt="architect.png"></p><h2 id="é›†ç¾¤éƒ¨ç½²"><a href="#é›†ç¾¤éƒ¨ç½²" class="headerlink" title="é›†ç¾¤éƒ¨ç½²"></a>é›†ç¾¤éƒ¨ç½²</h2><h3 id="é›†ç¾¤ç½‘ç»œè§„åˆ’åŠå­ç½‘é…ç½®"><a href="#é›†ç¾¤ç½‘ç»œè§„åˆ’åŠå­ç½‘é…ç½®" class="headerlink" title="é›†ç¾¤ç½‘ç»œè§„åˆ’åŠå­ç½‘é…ç½®"></a>é›†ç¾¤ç½‘ç»œè§„åˆ’åŠå­ç½‘é…ç½®</h3><p>æ—¢ç„¶æ˜¯åšé›†ç¾¤ï¼Œç½‘ç»œçš„è§„åˆ’æ˜¯å°‘ä¸äº†çš„,è‡³äºç½‘ç»œï¼Œå¯ä»¥é€šè¿‡Dockerä¸­çš„DockerNetworkingçš„æ”¯æŒé…ç½®ã€‚é¦–å…ˆè®¾ç½®ç½‘ç»œï¼Œdockerä¸­è®¾ç½® å­ç½‘å¯ä»¥é€šè¿‡docker network create æ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡å‘½ä»¤è®¾ç½®å¦‚ä¸‹çš„å­ç½‘ã€‚â€“subnetæŒ‡å®šå­ç½‘ç»œçš„ç½‘æ®µï¼Œå¹¶ä¸ºè¿™ä¸ªå­ç½‘å‘½åä¸€ä¸ªåå­—å«spark</p><pre><code class="shell"># åˆ›å»ºå­ç½‘docker network create --subnet=172.16.0.0/16 spark# æŸ¥çœ‹ç½‘ç»œdocker network lsNETWORK ID          NAME                       DRIVER              SCOPEfab2dd51d1cf        spark                      bridge              local</code></pre><p> æ¥ä¸‹æ¥å°±åœ¨æˆ‘ä»¬åˆ›å»ºçš„å­ç½‘è½sparkä¸­è§„åˆ’é›†ç¾¤ä¸­æ¯ä¸ªå®¹å™¨çš„ipåœ°å€ã€‚ç½‘ç»œipåˆ†é…å¦‚ä¸‹:</p><p>hadoop-master 172.16.0.2</p><p>hadoop-node1 172.16.0.3</p><p>hadoop-node2 172.16.0.4</p><h3 id="è½¯ä»¶ç‰ˆæœ¬"><a href="#è½¯ä»¶ç‰ˆæœ¬" class="headerlink" title="è½¯ä»¶ç‰ˆæœ¬"></a>è½¯ä»¶ç‰ˆæœ¬</h3><p>ç½‘ç»œè§„åˆ’å¥½äº†ï¼Œé¦–å…ˆSparkæˆ‘ä»¬ä½¿ç”¨æœ€æ–°çš„2.4.4ç‰ˆæœ¬ï¼ŒHadoopé‡‡ç”¨æ¯”è¾ƒç¨³å®šçš„hadoop-2.7.3ç‰ˆæœ¬ï¼Œscalaé‡‡ç”¨scala-2.11.8ï¼ŒJDKé‡‡ç”¨jdk-8u101-linux-x64ã€‚</p><h3 id="SSHæ— å¯†é’¥ç™»å½•è§„åˆ™é…ç½®"><a href="#SSHæ— å¯†é’¥ç™»å½•è§„åˆ™é…ç½®" class="headerlink" title="SSHæ— å¯†é’¥ç™»å½•è§„åˆ™é…ç½®"></a>SSHæ— å¯†é’¥ç™»å½•è§„åˆ™é…ç½®</h3><p>æ³¨æ„è¿™é‡Œä¸ä½¿ç”¨ssh-keygen -t rsa -P â€˜â€™è¿™ç§æ–¹å¼ç”Ÿæˆid_rsa.pubï¼Œç„¶åé›†ç¾¤èŠ‚ç‚¹äº’æ‹·è´id_rsa.pubåˆ°authorized_keysæ–‡ä»¶è¿™ç§æ–¹å¼ï¼Œè€Œ æ˜¯é€šè¿‡åœ¨.sshç›®å½•ä¸‹é…ç½®ssh_confæ–‡ä»¶çš„æ–¹å¼ï¼Œssh_confä¸­å¯ä»¥é…ç½®SSHçš„é€šä¿¡è§„åˆ™ï¼Œä¾‹å¦‚ä»¥æ­£åˆ™è¡¨è¾¾å¼çš„æ–¹å¼æŒ‡å®šhostnameä¸ºXXXçš„ æœºå™¨ä¹‹é—´å®ç°äº’è”äº’é€šï¼Œè€Œä¸è¿›è¡Œé¢å¤–çš„å¯†é’¥éªŒè¯ã€‚ä¸ºäº†ç¼–å†™è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬5ä¸ªèŠ‚ç‚¹çš„hostnameéƒ½ä»¥hadoop-*çš„æ–¹å¼ä½œä¸ºå¼€ å¤´ï¼Œè¿™å°±æ˜¯é‡‡ç”¨è¿™ç§å‘½åè§„åˆ™çš„åŸå› ã€‚ä¸‹é¢æ¥çœ‹ä¸‹ssh_confé…ç½®çš„å†…å®¹:</p><pre><code class="shell">Host localhost    StrictHostKeyChecking noHost 0.0.0.0     StrictHostKeyChecking noHost hadoop-*     StrictHostKeyChecking no</code></pre><p>æ³¨æ„ä¸Šé¢çš„æœ€åä¸€è¡Œï¼ŒHost hadoop-* æŒ‡å®šäº†å®ƒçš„ä¸¥æ ¼çš„HostéªŒè¯StrictHostKeyChecking ä¸ºnoï¼Œè¿™æ ·æ—¢å¯ä»¥æ˜¯è¿™5ä¸ªhostnameä»¥ hadoop-*å¼€å¤´çš„å®¹å™¨ä¹‹é—´å®ç°äº’è”äº’é€šï¼Œè€Œä¸éœ€è¦äºŒå¤–çš„éªŒè¯ã€‚</p><h3 id="æ„å»ºé•œåƒ"><a href="#æ„å»ºé•œåƒ" class="headerlink" title="æ„å»ºé•œåƒ"></a>æ„å»ºé•œåƒ</h3><p>Dockerfileç¼–å†™å®Œæˆï¼Œæ¥ä¸‹æ¥å†™ä¸€ä¸ªbuild.shè„šæœ¬ï¼Œå†…å®¹å¦‚ä¸‹:</p><pre><code class="shell"> echo build hadoop images docker build -t=&quot;spark&quot; . </code></pre><p>è¡¨ç¤ºæ„å»ºä¸€ä¸ªåå«sparkçš„é•œåƒï¼Œ.è¡¨ç¤ºDockerfileçš„è·¯å¾„ï¼Œå› ä¸ºåœ¨å½“å‰è·¯å¾„ä¸‹ï¼Œæ‰€æœ‰ç”¨.,è‹¥åœ¨å…¶ä»–åœ°æ–¹åˆ™ç”¨ç»å¯¹è·¯å¾„æŒ‡å®šDockerfileçš„è·¯å¾„ å³å¯ã€‚</p><p>è¿è¡Œsh build.shï¼Œå°±ä¼šå¼€å§‹åˆ¶ä½œé•œåƒäº†ã€‚</p><h2 id="é›†ç¾¤è¿è¡Œ"><a href="#é›†ç¾¤è¿è¡Œ" class="headerlink" title="é›†ç¾¤è¿è¡Œ"></a>é›†ç¾¤è¿è¡Œ</h2><h3 id="å¯åŠ¨å®¹å™¨-start-container-sh"><a href="#å¯åŠ¨å®¹å™¨-start-container-sh" class="headerlink" title="å¯åŠ¨å®¹å™¨ start_container.sh"></a>å¯åŠ¨å®¹å™¨ start_container.sh</h3><p>ä½¿ç”¨è¿™ä¸ªé•œåƒå¯å®Œæˆå®¹å™¨çš„å¯åŠ¨ï¼Œå› ä¸ºä½¿ç”¨äº†åŸºäºDockerNetworkingçš„ç½‘ç»œæœºåˆ¶ï¼Œå› æ­¤å¯ä»¥åœ¨å¯åŠ¨å®¹å™¨çš„æ—¶å€™ä¸ºå®¹å™¨åœ¨å­ç½‘172.16.0.0/16 sparkä¸­åˆ†è´172.16.0.1 172.16.0.255ä»¥å¤–çš„IPåœ°å€ï¼Œå®¹å™¨å†…éƒ¨å®¹å™¨çš„é€šä¿¡æ˜¯åŸºäºhostnameï¼Œå› æ­¤ éœ€è¦æŒ‡å®šhostnameï¼Œä¸ºäº†æ–¹ä¾¿å®¹å™¨çš„ç®¡ç†ï¼Œéœ€è¦ä¸ºå¯åŠ¨çš„æ¯ä¸ªå®¹å™¨æŒ‡å®šä¸€ä¸ªåå­—ã€‚ä¸ºäº†æ–¹ä¾¿å¤–ç½‘è®¿é—®ï¼Œéœ€è¦é€šè¿‡-på‘½ä»¤æŒ‡å®šå®¹å™¨åˆ°å®¿ä¸»æœºçš„ç«¯å£æ˜ å°„ã€‚è¿˜è¦ä¸ºæ¯ä¸ªå®¹å™¨å¢åŠ hoståˆ—è¡¨ã€‚</p><pre><code class="shell"># hadoop-masterdocker run -itd --restart=always \    --net spark \    --ip 172.16.0.2 \    --privileged \    -p 18032:8032 \    -p 28080:18080 \    -p 29888:19888 \    -p 17077:7077 \    -p 51070:50070 \    -p 18888:8888 \    -p 19000:9000 \    -p 11100:11000 \    -p 51030:50030 \    -p 18050:8050 \    -p 18081:8081 \    -p 18900:8900 \    --name hadoop-master \    --hostname hadoop-master \    --add-host hadoop-node1:172.16.0.3 \    --add-host hadoop-node2:172.16.0.4 \    --add-host hadoop-mysql:172.16.0.6 \    spark /usr/sbin/init# hadoop-node1docker run -itd --restart=always \    --net spark \    --ip 172.16.0.3 \    --privileged \    -p 18042:8042 \    -p 51010:50010 \    -p 51020:50020 \    --name hadoop-node1 \    --hostname hadoop-node1 \    --add-host hadoop-master:172.16.0.2 \    --add-host hadoop-node2:172.16.0.4 \    spark /usr/sbin/init# hadoop-node2docker run -itd --restart=always \    --net spark \    --ip 172.16.0.4 \    --privileged \    -p 18043:8042 \    -p 51011:50011 \    -p 51021:50021 \    --name hadoop-node2 \    --hostname hadoop-node2 \    --add-host hadoop-master:172.16.0.2 \    --add-host hadoop-node1:172.16.0.3 \    spark /usr/sbin/init</code></pre><h3 id="å…³é—­é›†ç¾¤-stop-container-sh"><a href="#å…³é—­é›†ç¾¤-stop-container-sh" class="headerlink" title="å…³é—­é›†ç¾¤ stop_container.sh"></a>å…³é—­é›†ç¾¤ stop_container.sh</h3><pre><code class="shell">echo stop containersdocker stop hadoop-masterdocker stop hadoop-node1docker stop hadoop-node2echo remove containersdocker rm hadoop-masterdocker rm hadoop-node1docker rm hadoop-node2echo rm containersdocker ps</code></pre><h3 id="é‡å¯é›†ç¾¤-restart-container-sh"><a href="#é‡å¯é›†ç¾¤-restart-container-sh" class="headerlink" title="é‡å¯é›†ç¾¤ restart_container.sh"></a>é‡å¯é›†ç¾¤ restart_container.sh</h3><pre><code class="shell">echo stop containersdocker stop hadoop-masterdocker stop hadoop-node1docker stop hadoop-node2echo restart containersdocker start hadoop-masterdocker start hadoop-node1docker start hadoop-node2echo start sshddocker exec -it hadoop-master systemctl start sshddocker exec -it hadoop-node1 systemctl start sshddocker exec -it hadoop-node2 systemctl start sshddocker exec -it hadoop-master ~/restart-hadoop.shecho  containers starteddocker ps</code></pre><h2 id="Trouble-Shooting"><a href="#Trouble-Shooting" class="headerlink" title="Trouble Shooting"></a>Trouble Shooting</h2><ul><li><p>dockeré‡Œé¢æ‰§è¡ŒsystemctlæŠ¥é”™</p><p>è§£å†³æ–¹æ¡ˆï¼šå¯åŠ¨çš„æ—¶å€™ç”¨/usr/sbin/init</p></li><li><p>dockerç™»å½•harboræŠ¥é”™<br>windowç›´æ¥ä¿®æ”¹dockerè®¾ç½®ï¼Œæ·»åŠ 52.83.79.244:8093åˆ°docker insecure registry<br>linuxä¿®æ”¹æ–¹æ³•ï¼š<a href="https://blog.csdn.net/u010397369/article/details/42422243" target="_blank" rel="noopener">https://blog.csdn.net/u010397369/article/details/42422243</a>  </p></li></ul><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p>è¿›å…¥hadoop-masterå®¹å™¨å†…éƒ¨ï¼Œæ‰§è¡Œspark-shell</p><pre><code class="shell">root@node-2 docker-spark]# docker exec -it hadoop-master /bin/bash[root@hadoop-master ~]# sparkspark-class   spark-shell   spark-sql     spark-submit  sparkR[root@hadoop-master ~]# spark-shell19/12/03 04:51:25 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicableSetting default log level to &quot;WARN&quot;.To adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).19/12/03 04:51:43 WARN util.Utils: spark.executor.instances less than spark.dynamicAllocation.minExecutors is invalid, ignoring its setting, please update your configs.Spark context Web UI available at http://hadoop-master:4040Spark context available as &#39;sc&#39; (master = spark://hadoop-master:7077, app id = app-20191203045141-0000).Spark session available as &#39;spark&#39;.Welcome to      ____              __     / __/__  ___ _____/ /__    _\ \/ _ \/ _ `/ __/  &#39;_/   /___/ .__/\_,_/_/ /_/\_\   version 2.4.4      /_/Using Scala version 2.11.12 (Java HotSpot(TM) 64-Bit Server VM, Java 1.8.0_101)Type in expressions to have them evaluated.Type :help for more information.scala&gt;</code></pre><h2 id="æœ¬åœ°éƒ¨ç½²"><a href="#æœ¬åœ°éƒ¨ç½²" class="headerlink" title="æœ¬åœ°éƒ¨ç½²"></a>æœ¬åœ°éƒ¨ç½²</h2><ul><li><p>æƒ³è¦åœ¨è‡ªå·±çš„ç¬”è®°æœ¬ç¯å¢ƒä½¿ç”¨</p><p>é¦–å…ˆç¬”è®°æœ¬ç¯å¢ƒä¸‹éœ€è¦æœ‰dockerç¯å¢ƒ</p><ul><li>æ‹‰å–gitlabä¸Šé¢çš„é¡¹ç›®ï¼šgit clone <a href="mailto:git@161.189.27.8">git@161.189.27.8</a>:chenliang/docker-spark.git</li><li>æ‹‰å»harborä¸Šé¢çš„é•œåƒï¼šdocker pull 52.83.79.244:8093/wuhan/spark:v1ï¼ˆä¹Ÿå¯ä»¥è‡ªå·±æ„å»ºé•œåƒï¼ŒDockerfileæ–‡ä»¶åœ¨gitlabé¡¹ç›®é‡Œè¾¹ï¼‰<br>  å‰æï¼šæœºå™¨dockerç¯å¢ƒç™»å½•harborï¼Œè´¦å·å¯†ç ï¼šadmin 1qaz!QAZ<br>docker login 52.83.79.244:8093<br>ç™»å½•æŠ¥é”™ï¼šError response from daemon: Get <a href="https://52.83.79.244:8093/v2/" target="_blank" rel="noopener">https://52.83.79.244:8093/v2/</a>: http: server gave HTTP response to HTTPS client<br>è§£å†³ï¼šå‚è§trouble shooting</li><li>ä½¿ç”¨ç›¸å…³è„šæœ¬æ‰§è¡Œå¯åŠ¨ã€åœæ­¢ã€é‡å¯é›†ç¾¤</li></ul></li></ul><ul><li><p>å¦‚ä½•è‡ªå·±çš„sparkç¨‹åºå¦‚ä½•åœ¨dockerç¯å¢ƒä¸‹æ‰§è¡Œ  </p><p>å¯åŠ¨sparkçš„é›†ç¾¤ä¹‹åï¼Œä½¿ç”¨docker cpç­‰å‘½ä»¤å°†æ‰“å¥½çš„jaråŒ…æ‰“è¿›å®¹å™¨å†…ï¼Œä½¿ç”¨sparkè„šæœ¬æ‰§è¡Œ</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>è¿ç»´</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>ç¯å¢ƒ</tag>
      
      <tag>å¤§æ•°æ®</tag>
      
      <tag>éƒ¨ç½²</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Dockeréƒ¨ç½²Nextcloud</title>
    <link href="/2020/01/09/Docker%E9%83%A8%E7%BD%B2Nextcloud/"/>
    <url>/2020/01/09/Docker%E9%83%A8%E7%BD%B2Nextcloud/</url>
    
    <content type="html"><![CDATA[<h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><h3 id="dockerçš„å®‰è£…åŠé…ç½®"><a href="#dockerçš„å®‰è£…åŠé…ç½®" class="headerlink" title="dockerçš„å®‰è£…åŠé…ç½®"></a>dockerçš„å®‰è£…åŠé…ç½®</h3><pre><code class="shell"># é€šè¿‡yumå®‰è£…yum install -y docker-ce# å¯åŠ¨dockerå¹¶è®¾ç½®å¼€æœºå¯åŠ¨systemctl start dockersystemctl enable docker# aws ec2 linux2å¦å¤–ä¸€ç§å®‰è£…æ–¹å¼sudo amazon-linux-extras install dockersudo service docker start</code></pre><p>ç”±äºdockeré•œåƒæºé»˜è®¤æ˜¯åœ¨å›½å¤–ï¼Œæ‹‰å–é•œåƒé€Ÿåº¦éå¸¸æ…¢ï¼Œä¿®æ”¹daemoné…ç½®æ–‡ä»¶/etc/docker/daemon.jsonæ¥ä½¿ç”¨åŠ é€Ÿå™¨</p><pre><code class="shell">mkdir -p /etc/dockertouch /etc/docker/daemon.jsonvim /etc/docker/daemon.json{  &quot;registry-mirrors&quot;: [&quot;https://b3sst9pc.mirror.aliyuncs.com&quot;]}systemctl daemon-reloadsystemctl restart docker</code></pre><h3 id="docker-composeå®‰è£…"><a href="#docker-composeå®‰è£…" class="headerlink" title="docker-composeå®‰è£…"></a>docker-composeå®‰è£…</h3><p>Docker Composeæ˜¯ docker æä¾›çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨æ¥å®šä¹‰å’Œè¿è¡Œç”±å¤šä¸ªå®¹å™¨ç»„æˆçš„åº”ç”¨ã€‚ä½¿ç”¨ composeï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ YAML æ–‡ä»¶å£°æ˜å¼çš„å®šä¹‰åº”ç”¨ç¨‹åºçš„å„ä¸ªæœåŠ¡ï¼Œå¹¶ç”±å•ä¸ªå‘½ä»¤å®Œæˆåº”ç”¨çš„åˆ›å»ºå’Œå¯åŠ¨ã€‚</p><ul><li><p>docker-composeå‘½ä»¤å®‰è£…</p><pre><code class="shell"># å®‰è£…pipyum -y install epel-releaseyum -y install python-pip# ç¡®è®¤ç‰ˆæœ¬pip --version# æ›´æ–°pippip install --upgrade pip# å®‰è£…docker-composepip install docker-compose # æŸ¥çœ‹ç‰ˆæœ¬docker-compose version</code></pre></li></ul><h2 id="nextcloudçš„éƒ¨ç½²"><a href="#nextcloudçš„éƒ¨ç½²" class="headerlink" title="nextcloudçš„éƒ¨ç½²"></a>nextcloudçš„éƒ¨ç½²</h2><p>nextcloudé€šè¿‡docker-composeå‘½ä»¤è¿›è¡Œæ„å»ºï¼Œåˆ›å»º docker-compose.ymlæ–‡ä»¶</p><pre><code class="shell"># åˆ›å»ºdocker-compose.ymlæ–‡ä»¶touch docker-compose.yml# ç²˜è´´ä»¥ä¸‹å†…å®¹version: &#39;2&#39;services:  db:    image: mariadb    restart: always    volumes:      - /data/mariadb:/var/lib/mysql    environment:      - MYSQL_ROOT_PASSWORD=root      - MYSQL_PASSWORD=nextcloud      - MYSQL_DATABASE=nextcloud      - MYSQL_USER=nextcloud  app:    image: nextcloud    restart: always    ports:      - 8091:80    links:      - db    volumes:      - /data/nextcloud/data:/var/www/html/data          - /data/nextcloud/themes:/var/www/html/themes      - /data/nextcloud/apps:/var/www/html/custom_apps</code></pre><p>docker-compose.ymlæ–‡ä»¶è¯´æ˜</p><p>é€šè¿‡å¯åŠ¨ä¸¤ä¸ªserviceæœåŠ¡mariadbåŠnextcloudæœåŠ¡ï¼Œå¹¶é€šè¿‡linkè¿æ¥åˆ°ä¸€èµ·ï¼Œå…¶ä¸­å°†/var/www/html/dataã€/var/www/html/themesã€/var/www/html/custom_appsæ˜ å°„åˆ°linuxæœåŠ¡å™¨æŒ‡å®šç›®å½•å®ç°æ•°æ®æŒä¹…åŒ–ï¼Œè¿™æ ·ä¸‹æ¬¡dockeré‡å¯çš„æ—¶å€™æ•°æ®ä¸ä¼šå‘ç”Ÿä¸¢å¤±ã€‚</p><p>nextcloudå®ç°é¢„è§ˆç¼–è¾‘officeæ–‡ä»¶éœ€è¦æ’ä»¶onlyofficeæ”¯æŒï¼Œé€šè¿‡dockeråˆ›å»ºonlyofficeæœåŠ¡å™¨ï¼Œå¹¶å¯åŠ¨nextcloudé…ç½®onlyoffice</p><pre><code class="shell">docker run -it -d -p 8061:80 onlyoffice/documentserver  -v /data/onlyoffice/logs:/var/log/onlyoffice /data/onlyoffice/data:/var/www/onlyoffice/Data /data/onlyoffice/lib:/var/lib/onlyoffice /data/onlyoffice/db:/var/lib/postgresql</code></pre><p>å¯åŠ¨nextcloudã€åœæ­¢nextcloudã€æŸ¥çœ‹nextcloudå¯åŠ¨çŠ¶æ€</p><pre><code class="shell"># å¯åŠ¨nextclouddocker-compose up -d# æŸ¥çœ‹nextcloudçŠ¶æ€docker-compose ps# åœæ­¢nextclouddocker-compose stop</code></pre><h2 id="nextcloudçš„æ•°æ®è¿ç§»"><a href="#nextcloudçš„æ•°æ®è¿ç§»" class="headerlink" title="nextcloudçš„æ•°æ®è¿ç§»"></a>nextcloudçš„æ•°æ®è¿ç§»</h2><p>å½“éœ€è¦nextcloudè¿ç§»åˆ°å¦å¤–ä¸€å°æœåŠ¡çš„æ—¶å€™ï¼Œéœ€è¦å°†nextcloudæŒä¹…åŒ–çš„æ•°æ®é€šè¿‡scpæˆ–è€…å…¶ä»–æ–¹å¼å¤åˆ¶åˆ°å¦å¤–ä¸€å°æœºå™¨ï¼Œå°†åŸæ¥çš„æœºå™¨mariadbçš„nextcloudæ•°æ®åº“è¿›è¡Œå¯¼å‡ºï¼Œåœ¨æ–°çš„æœºå™¨ä¸Šé¢å¯¼å…¥æ•°æ®åº“æ•°æ®ã€‚å¤åˆ¶YAMLæ–‡ä»¶åˆ°æ–°çš„æœºå™¨ï¼Œé€šè¿‡docker-composeè¿›è¡Œå¯åŠ¨ï¼Œè¿›å…¥å®¹å™¨å†…éƒ¨ä¿®æ”¹æŒä¹…åŒ–æ•°æ®çš„æƒé™åŠä¿®æ”¹nextcloudé…ç½®æ–‡ä»¶ï¼Œæœ€åé‡å¯å®¹å™¨ã€‚</p><pre><code class="shell"># å¤åˆ¶æŒä¹…åŒ–æ•°æ®åˆ°æ–°çš„æœºå™¨ä¸Šé¢scp -R /data/nextcloud root@192.168.12.1:/data# å¯¼å‡ºåŸæ¥æœºå™¨çš„ä¸Šé¢çš„mariadbæ•°æ®docker exec -it  nextcloud_db_1ã€dockerå®¹å™¨åç§°/IDã€‘ mysqldump -uroot -prootã€æ•°æ®åº“å¯†ç ã€‘ nextcloudã€æ•°æ®åº“åç§°ã€‘ &gt; /opt/sql_bak/nextcloud.sqlã€å¯¼å‡ºè¡¨æ ¼è·¯å¾„ã€‘# å°†sqlæ–‡ä»¶å¤åˆ¶åˆ°æ–°çš„æœºå™¨ä¸Šé¢scp  /opt/sql_bak/nextcloud.sql root@192.168.12.1:/opt/sql_bak# åœ¨æ–°çš„æœºå™¨ä¸Šé¢æ‰§è¡Œè¯¥sqlæ–‡ä»¶(éœ€è¦å…ˆå¯åŠ¨dockerå®¹å™¨)docker cp /opt/sql_bak/nextcloud.sql ã€å®¹å™¨åã€‘:/root/docker exec -it ã€å®¹å™¨å/IDã€‘shmysql -uroot -p nextcloudã€æ•°æ®åº“åã€‘ &lt; /root/nextcloud.sql# é€šè¿‡docker-composeå¯åŠ¨é•œåƒï¼Œä¿®æ”¹æƒé™ docker exec -it -u root nextcloud_app_1ã€å®¹å™¨id/å®¹å™¨åã€‘ /bin/bash root@bafc02ce112a:/var/www/html# chown -R www-data:root /var/www/html/ root@bafc02ce112a:exit# ä¿®æ”¹nextcloudé…ç½®æ–‡ä»¶vim /data/nextcloud/config/config.php# ä¿®æ”¹ip&#39;trusted_domains&#39; =&gt;  array (    0 =&gt; &#39;161.189.27.8:8091&#39;,  ),  &#39;datadirectory&#39; =&gt; &#39;/var/www/html/data&#39;,  &#39;dbtype&#39; =&gt; &#39;mysql&#39;,  &#39;version&#39; =&gt; &#39;16.0.4.1&#39;,  &#39;overwrite.cli.url&#39; =&gt; &#39;http://161.189.27.8:8091&#39;,# é‡å¯docker-compose restart</code></pre><h2 id="trouble-shooting"><a href="#trouble-shooting" class="headerlink" title="trouble shooting"></a>trouble shooting</h2><ul><li><p>å®‰è£…docker-composeå‘½ä»¤æ‰§è¡Œpip install docker-composeçš„æ—¶å€™æŠ¥ä»¥ä¸‹é”™è¯¯</p><pre><code>ERROR: Cannot uninstall &#39;requests&#39;. It is a distutils installed project and thus we cannot accurately determine which files belong to it which would lead to only a partial uninstall.</code></pre><p>è§£å†³ç‰ˆæœ¬ï¼Œå¼ºåˆ¶å®‰è£…requestsåŒ…</p><pre><code class="shell"> pip install --ignore-installed requests</code></pre><p>å†é‡æ–°æ‰§è¡Œ</p><pre><code class="shell">pip install docker-compose</code></pre></li><li><p>docker-composeæŠ¥é”™ï¼šNo module named ssl_match_hostname</p><pre><code>File &quot;/usr/local/lib/python2.7/dist-packages/docker/transport/ssladapter.py&quot;, line 23, in &lt;module&gt;from backports.ssl_match_hostname import match_hostnameImportError: No module named ssl_match_hostname</code></pre><p>åŸå› ï¼š</p><p><strong>/usr/local/lib/python2.7/distpackages/docker/transport/ssladapter.py **<br>åœ¨åŒ…è·¯å¾„ä¸‹æ‰¾ä¸åˆ° **backportsåŒ…é‡Œçš„ssl_match_hostname</strong>æ¨¡å—</p><p>è§£å†³åŠæ³•</p><pre><code class="shell">#è¿›å…¥backportsæ¨¡å—è·¯å¾„cd /usr/lib/python2.7/site-packages#å¤åˆ¶æ•´ä¸ªåŒ…åˆ°transportåŒ…è·¯å¾„ä¸‹cp -r backports /usr/lib/python2.7/site-packages/docker/transport</code></pre></li></ul>]]></content>
    
    
    <categories>
      
      <category>è¿ç»´</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>nextcloud</tag>
      
      <tag>ç½‘ç›˜</tag>
      
      <tag>éƒ¨ç½²</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Dockerç§æœHarborä½¿ç”¨æŒ‡å—</title>
    <link href="/2020/01/09/Harbor%E9%83%A8%E7%BD%B2/"/>
    <url>/2020/01/09/Harbor%E9%83%A8%E7%BD%B2/</url>
    
    <content type="html"><![CDATA[<h2 id="harboræ­å»º"><a href="#harboræ­å»º" class="headerlink" title="harboræ­å»º"></a>harboræ­å»º</h2><p>å®˜æ–¹æä¾›ä¸¤ç§æ–¹å¼å®‰è£…harborï¼Œç¦»çº¿åŠåœ¨çº¿æ–¹å¼ã€‚æœ¬æ–‡æ¡£æè¿°ç¦»çº¿æ–¹å¼è¿›è¡Œå®‰è£…</p><p>æŸ¥çœ‹docker-composeç‰ˆæœ¬ï¼Œè‹¥ç‰ˆæœ¬ä½è¿›è¡Œå‡çº§å®‰è£…ï¼Œ</p><p>ä¸‹è½½å®˜æ–¹å®‰è£…åŒ…</p><pre><code class="shell">cd /optwget https://storage.googleapis.com/harbor-releases/release-1.9.0/harbor-offline-installer-v1.9.2-rc1.tgz# è§£å‹tar zxvf harbor-offline-installer-v1.9.2-rc1.tgz# æŸ¥çœ‹cd harborls[root@ip-172-31-23-16 harbor]# lltotal 623296drwxr-xr-x 3 root root        20 Nov  5 05:50 common-rw-r--r-- 1 root root      5369 Nov  5 06:07 docker-compose.yml-rw-r--r-- 1 root root 638214056 Nov  1 03:14 harbor.v1.9.2.tar.gz-rw-r--r-- 1 root root      5816 Nov  5 06:07 harbor.yml-rwxr-xr-x 1 root root      5088 Nov  1 03:13 install.sh-rw-r--r-- 1 root root     11347 Nov  1 03:13 LICENSE-rwxr-xr-x 1 root root      1748 Nov  1 03:13 prepare</code></pre><p>ä¿®æ”¹é…ç½®ï¼Œä¸»è¦ä¿®æ”¹ä¸¤ä¸ªæ–‡ä»¶</p><p>harbor.ymlä¸ºç³»ç»Ÿé…ç½®æ–‡ä»¶ï¼Œdocker-compose.ymlä¸ºdockerç›¸å…³é…ç½®æ–‡ä»¶</p><p>ä¿®æ”¹harbor.yml</p><pre><code class="shell">vim harbor.yml# ä¿®æ”¹hostnamehostname: 52.83.79.244# ä¿®æ”¹æ˜ å°„ç«¯å£http:  port: 8093# ä¿®æ”¹admin passwordï¼ˆå¯é€‰ï¼‰harbor_admin_password: 1qaz!QAZ# ä¿®æ”¹æ•°æ®åº“ç›¸å…³å‚æ•°database:  password: root  max_idle_conns: 50  max_open_conns: 100# ä¿®æ”¹æ•°æ®æŒä¹…åŒ–hostç›®å½•data_volume: /data/harbor# ä¿®æ”¹logç›®å½• location: /var/log/harbor</code></pre><p>ä¿®æ”¹docker-compose.ymlæ–‡ä»¶</p><pre><code class="yaml">vim docker-compose.yml# æ·»åŠ portsæ˜ å°„registry:    image: goharbor/registry-photon:v2.7.1-patch-2819-2553-v1.9.2    container_name: registry    restart: always    ports:      - 5000:5000</code></pre><p>å¯åŠ¨harbor</p><pre><code>./install.sh</code></pre><p>å®‰è£…ä¹‹åæŸ¥çœ‹</p><pre><code class="shell">docker-compose ps     Name                     Command                  State                 Ports---------------------------------------------------------------------------------------------harbor-core         /harbor/harbor_core              Up (healthy)harbor-db           /docker-entrypoint.sh            Up (healthy)   5432/tcpharbor-jobservice   /harbor/harbor_jobservice  ...   Up (healthy)harbor-log          /bin/sh -c /usr/local/bin/ ...   Up (healthy)   127.0.0.1:1514-&gt;10514/tcpharbor-portal       nginx -g daemon off;             Up (healthy)   8080/tcpnginx               nginx -g daemon off;             Up (healthy)   0.0.0.0:8093-&gt;8080/tcpredis               redis-server /etc/redis.conf     Up (healthy)   6379/tcpregistry            /entrypoint.sh /etc/regist ...   Restartingregistryctl         /harbor/start.sh                 Up (healthy)</code></pre><p>ç™»å½•harbor ï¼Œè´¦å·å¯†ç ä¸ºharbor.ymlæ‰€è®¾ç½®çš„å¯†ç </p><p><a href="http://52.83.79.244:8093/harbor/projects" target="_blank" rel="noopener">http://52.83.79.244:8093/harbor/projects</a></p><p>ç™»å½•æ—¶å€™è¿˜ä¸èƒ½ç›´æ¥åˆ©ç”¨docker push åˆ°æœåŠ¡å™¨ï¼Œè¿™æ˜¯å› ä¸º docker1.3.2 ç‰ˆæœ¬å¼€å§‹é»˜è®¤ docker registry ä½¿ç”¨çš„æ˜¯ httpsï¼Œæˆ‘ä»¬è®¾ç½® Harbor é»˜è®¤ http æ–¹å¼ï¼Œæ‰€ä»¥å½“æ‰§è¡Œç”¨ docker loginã€pullã€push ç­‰å‘½ä»¤æ“ä½œé https çš„ docker regsitry çš„æ—¶å°±ä¼šæŠ¥é”™ã€‚è§£å†³åŠæ³•ï¼š</p><pre><code class="shell">vim /usr/lib/systemd/system/docker.service# ExecStart å¢åŠ  --insecure-registry=52.83.79.244ã€é…ç½®æ–‡ä»¶ä¸­çš„hostnameã€‘ExecStart=/usr/bin/dockerd $OPTIONS $DOCKER_STORAGE_OPTIONS $DOCKER_ADD_RUNTIMES --insecure-registry=52.83.79.244:8093# é‡å¯æœåŠ¡systemctl daemon-reloadsystemctl restart docker</code></pre><p>harborå¸¸ç”¨å‘½ä»¤</p><pre><code class="shell"># éœ€è¦è¿›å…¥harboræ–‡ä»¶å¤¹æ‰§è¡Œcd /opt/harbordocker-compose up -d               ###åå°å¯åŠ¨ï¼Œå¦‚æœå®¹å™¨ä¸å­˜åœ¨æ ¹æ®é•œåƒè‡ªåŠ¨åˆ›å»ºdocker-compose down   -v           ###åœæ­¢å®¹å™¨å¹¶åˆ é™¤å®¹å™¨docker-compose start               ###å¯åŠ¨å®¹å™¨ï¼Œå®¹å™¨ä¸å­˜åœ¨å°±æ— æ³•å¯åŠ¨ï¼Œä¸ä¼šè‡ªåŠ¨åˆ›å»ºé•œåƒdocker-compose stop                ###åœæ­¢å®¹å™¨</code></pre><h2 id="ä½¿ç”¨åŠé…ç½®"><a href="#ä½¿ç”¨åŠé…ç½®" class="headerlink" title="ä½¿ç”¨åŠé…ç½®"></a>ä½¿ç”¨åŠé…ç½®</h2><ul><li><p>docker ç™»å½•åˆ°harbor</p><pre><code class="shell">[root@ip-172-31-23-16 harbor]# docker login 52.83.79.244:8093Username: adminPassword:WARNING! Your password will be stored unencrypted in /root/.docker/config.json.Configure a credential helper to remove this warning. Seehttps://docs.docker.com/engine/reference/commandline/login/#credentials-storeLogin Succeeded</code></pre></li></ul><p>ç™»å½•harborååˆ›å»ºä¸€ä¸ªå…¬å…±ä»“åº“ï¼Œå‘½åä¸ºwuhan</p><p>å°†é•œåƒå‘å¸ƒåˆ°harbor</p><pre><code class="shell"># æŸ¥çœ‹éœ€è¦ä¸Šä¼ çš„é•œåƒdocker images# ä¸ºé•œåƒä¸Štagdocker tag jenkins/jenkins:lts 52.83.79.244:8093/wuhan/jenkins:lts# ä¸Šä¼ åˆ°wuhanåº“docker push jenkins/jenkins:lts 52.83.79.244:8093/wuhan/jenkins:lts# è‹¥éœ€è¦ä¸Šä¼ åˆ°libraryåº“docker push jenkins/jenkins:lts 52.83.79.244:8093/library/jenkins:lts</code></pre><h2 id="é…ç½®httpsåè®®"><a href="#é…ç½®httpsåè®®" class="headerlink" title="é…ç½®httpsåè®®"></a>é…ç½®httpsåè®®</h2><pre><code class="shell"># å‡†å¤‡å·¥ä½œmkdir -p /data/harbor-certyum install -y openssl------------cd data/harbor-certopenssl genrsa -des3 -out server.key 2048 openssl req -new -key server.key -out server.csr cp server.key server.key.org openssl rsa -in server.key.org -out server.key openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt </code></pre><p>ç”Ÿæˆè¯ä¹¦ä¹‹åï¼Œä¿®æ”¹harbor.yamlæ–‡ä»¶<br>å…·ä½“é…ç½®å¦‚ä¸‹<br><a href="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/WX20191219-155232@2x.png" target="_blank" rel="noopener"><img src="http://52.83.79.244:6875/uploads/images/gallery/2019-12-Dec/scaled-840-0/WX20191219-155232@2x.png" srcset="/img/loading.gif" alt="WX20191219-155232@2x.png"></a></p><h2 id="ä½¿ç”¨åŠé…ç½®-1"><a href="#ä½¿ç”¨åŠé…ç½®-1" class="headerlink" title="ä½¿ç”¨åŠé…ç½®"></a>ä½¿ç”¨åŠé…ç½®</h2><ul><li><p>docker ç™»å½•åˆ°harbor</p><pre><code class="shell">[root@ip-172-31-23-16 harbor]# docker login 52.83.79.244:8093Username: adminPassword:WARNING! Your password will be stored unencrypted in /root/.docker/config.json.Configure a credential helper to remove this warning. Seehttps://docs.docker.com/engine/reference/commandline/login/#credentials-storeLogin Succeeded</code></pre></li></ul><p>ç™»å½•harborååˆ›å»ºä¸€ä¸ªå…¬å…±ä»“åº“ï¼Œå‘½åä¸ºwuhan</p><p>å°†é•œåƒå‘å¸ƒåˆ°harbor</p><pre><code class="shell"># æŸ¥çœ‹éœ€è¦ä¸Šä¼ çš„é•œåƒdocker images# ä¸ºé•œåƒä¸Štagdocker tag jenkins/jenkins:lts 52.83.79.244:8093/wuhan/jenkins:lts# ä¸Šä¼ åˆ°wuhanåº“docker push jenkins/jenkins:lts 52.83.79.244:8093/wuhan/jenkins:lts# è‹¥éœ€è¦ä¸Šä¼ åˆ°libraryåº“docker push 52.83.79.244:8093/library/jenkins:lts</code></pre><h2 id="trouble-shooting"><a href="#trouble-shooting" class="headerlink" title="trouble shooting"></a>trouble shooting</h2><ul><li>dockerç™»å½•harboræŠ¥é”™<br>windowç›´æ¥ä¿®æ”¹dockerè®¾ç½®ï¼Œæ·»åŠ 52.83.79.244:8093åˆ°docker insecure registry<br>linuxä¿®æ”¹æ–¹æ³•ï¼š<a href="https://blog.csdn.net/u010397369/article/details/42422243" target="_blank" rel="noopener">https://blog.csdn.net/u010397369/article/details/42422243</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>è¿ç»´</category>
      
    </categories>
    
    
    <tags>
      
      <tag>https</tag>
      
      <tag>è¯ä¹¦</tag>
      
      <tag>harbor</tag>
      
      <tag>docker</tag>
      
      <tag>éƒ¨ç½²</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>K8sç›‘æ§éƒ¨ç½²æ–¹æ¡ˆ</title>
    <link href="/2020/01/07/K8s%E7%9B%91%E6%8E%A7%E9%83%A8%E7%BD%B2%E6%96%B9%E6%A1%88/"/>
    <url>/2020/01/07/K8s%E7%9B%91%E6%8E%A7%E9%83%A8%E7%BD%B2%E6%96%B9%E6%A1%88/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h2><p><img src="https://i.loli.net/2020/01/08/DVBiRAwaNsnYbgL.png" srcset="/img/loading.gif" alt="grafana"></p><h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><p><strong>yamlæ–‡ä»¶åœ°å€ ğŸ‘‰ğŸ»   <a href="https://161.189.27.8:8090/dqdev/pythogoras/tree/master/k8s-yaml/prometheus" target="_blank" rel="noopener">pythagoras</a></strong></p><h3 id="1-åœ¨k8sé›†ç¾¤ä¸­åˆ›å»ºnamespace"><a href="#1-åœ¨k8sé›†ç¾¤ä¸­åˆ›å»ºnamespace" class="headerlink" title="1 åœ¨k8sé›†ç¾¤ä¸­åˆ›å»ºnamespace"></a>1 åœ¨k8sé›†ç¾¤ä¸­åˆ›å»ºnamespace</h3><pre><code class="yaml">apiVersion: v1kind: Namespacemetadata:   name: ns-monitor  labels:    name: ns-monitorkubectl apply -f namespace.yaml</code></pre><h3 id="2-å®‰è£…node-exporter"><a href="#2-å®‰è£…node-exporter" class="headerlink" title="2 å®‰è£…node-exporter"></a>2 å®‰è£…node-exporter</h3><p>åœ¨kubernetesté›†ç¾¤ä¸­éƒ¨ç½²node-exporterï¼ŒNode-exporterç”¨äºé‡‡é›†kubernetesé›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹çš„ç‰©ç†æŒ‡æ ‡ï¼Œæ¯”å¦‚ï¼šMemoryã€CPUç­‰ã€‚å¯ä»¥ç›´æ¥åœ¨æ¯ä¸ªç‰©ç†èŠ‚ç‚¹æ˜¯ç›´æ¥å®‰è£…ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨DaemonSetéƒ¨ç½²åˆ°æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œä½¿ç”¨ hostNetwork: true å’Œ hostPID: true ä½¿å…¶è·å¾—Nodeçš„ç‰©ç†æŒ‡æ ‡ä¿¡æ¯ï¼Œé…ç½®tolerationsä½¿å…¶åœ¨masterèŠ‚ç‚¹ä¹Ÿå¯åŠ¨ä¸€ä¸ªpodã€‚</p><p>node-exporter.yaml</p><pre><code class="yaml">kind: DaemonSetapiVersion: apps/v1beta2metadata:   labels:    app: node-exporter  name: node-exporter  namespace: ns-monitorspec:  revisionHistoryLimit: 10  selector:    matchLabels:      app: node-exporter  template:    metadata:      labels:        app: node-exporter    spec:      containers:        - name: node-exporter          image: prom/node-exporter:v0.16.0          ports:            - containerPort: 9100              protocol: TCP              name:    http      hostNetwork: true      hostPID: true      tolerations:        - effect: NoSchedule          operator: Exists---kind: ServiceapiVersion: v1metadata:  labels:    app: node-exporter  name: node-exporter-service  namespace: ns-monitorspec:  ports:    - name:    http      port: 9100      nodePort: 31672      protocol: TCP  type: NodePort  selector:    app: node-exporter</code></pre><pre><code class="shell">kubectl apply -f node-exporter.yaml</code></pre><p><strong>*æ£€æŸ¥æ˜¯å¦æ‰§è¡ŒæˆåŠŸ(å¯¹åº”podåŠsvc)</strong> ğŸ‘‰ğŸ» **</p><pre><code class="shell">âœ  ~ kubectl get pod -n ns-monitorNAME                          READY   STATUS    RESTARTS   AGEgrafana-547699f75-lxljq       1/1     Running   0          3h37mnode-exporter-75nmc           0/1     Pending   0          20hnode-exporter-t29kx           1/1     Running   0          20hnode-exporter-z6s7x           1/1     Running   0          20hprometheus-7d7654554d-f5fvf   1/1     Running   0          3h45mâœ  ~ kubectl get svc -n ns-monitorNAME                    TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGEgrafana-service         NodePort   10.1.242.56    &lt;none&gt;        3000:31026/TCP   3h38mnode-exporter-service   NodePort   10.1.130.7     &lt;none&gt;        9100:31672/TCP   20hprometheus-service      NodePort   10.1.133.130   &lt;none&gt;        9090:30753/TCP   3h45m</code></pre><p><img src="https://i.loli.net/2020/01/08/TP6tIlvFKhgzHuZ.png" srcset="/img/loading.gif" alt="image-20200103143320329"></p><h3 id="3-éƒ¨ç½²Prometheus-pod"><a href="#3-éƒ¨ç½²Prometheus-pod" class="headerlink" title="3 éƒ¨ç½²Prometheus pod"></a>3 éƒ¨ç½²Prometheus pod</h3><p>prometheus.yaml ä¸­åŒ…å«rbacè®¤è¯ã€ConfigMapç­‰</p><pre><code class="shell">kubectl apply -f prometheus.yaml </code></pre><p><em>æ£€æŸ¥æ˜¯å¦æ‰§è¡ŒæˆåŠŸ(å¯¹åº”podåŠsvc)*</em> ğŸ‘‰ğŸ» </p><pre><code class="shell">âœ  ~ kubectl get pod -n ns-monitorNAME                          READY   STATUS    RESTARTS   AGEgrafana-547699f75-lxljq       1/1     Running   0          3h37mnode-exporter-75nmc           0/1     Pending   0          20hnode-exporter-t29kx           1/1     Running   0          20hnode-exporter-z6s7x           1/1     Running   0          20hprometheus-7d7654554d-f5fvf   1/1     Running   0          3h45mâœ  ~ kubectl get svc -n ns-monitorNAME                    TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGEgrafana-service         NodePort   10.1.242.56    &lt;none&gt;        3000:31026/TCP   3h38mnode-exporter-service   NodePort   10.1.130.7     &lt;none&gt;        9100:31672/TCP   20hprometheus-service      NodePort   10.1.133.130   &lt;none&gt;        9090:30753/TCP   3h45m</code></pre><p><img src="https://i.loli.net/2020/01/08/fdFs8EN2xhHwCM6.png" srcset="/img/loading.gif" alt="image-20200103143645494"></p><h3 id="4-åœ¨k8sä¸­éƒ¨ç½²grafana"><a href="#4-åœ¨k8sä¸­éƒ¨ç½²grafana" class="headerlink" title="4 åœ¨k8sä¸­éƒ¨ç½²grafana"></a>4 åœ¨k8sä¸­éƒ¨ç½²grafana</h3><pre><code class="shell">kubectl apply -f grafana.yaml</code></pre><p><strong>æ£€æŸ¥æ˜¯å¦æ‰§è¡ŒæˆåŠŸ(å¯¹åº”podåŠsvc)</strong> ğŸ‘‰ğŸ» </p><pre><code class="shell">âœ  ~ kubectl get pod -n ns-monitorNAME                          READY   STATUS    RESTARTS   AGEgrafana-547699f75-lxljq       1/1     Running   0          3h37mnode-exporter-75nmc           0/1     Pending   0          20hnode-exporter-t29kx           1/1     Running   0          20hnode-exporter-z6s7x           1/1     Running   0          20hprometheus-7d7654554d-f5fvf   1/1     Running   0          3h45mâœ  ~ kubectl get svc -n ns-monitorNAME                    TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGEgrafana-service         NodePort   10.1.242.56    &lt;none&gt;        3000:31026/TCP   3h38mnode-exporter-service   NodePort   10.1.130.7     &lt;none&gt;        9100:31672/TCP   20hprometheus-service      NodePort   10.1.133.130   &lt;none&gt;        9090:30753/TCP   3h45m</code></pre><h3 id="5-é…ç½®grafanaæ•°æ®æº"><a href="#5-é…ç½®grafanaæ•°æ®æº" class="headerlink" title="5 é…ç½®grafanaæ•°æ®æº"></a>5 é…ç½®grafanaæ•°æ®æº</h3><p>æŠŠprometheusé…ç½®æˆæ•°æ®æº ï¼š<a href="http://prometheus-service.ns-monitor:9090" target="_blank" rel="noopener">http://prometheus-service.ns-monitor:9090</a></p><p><img src="https://i.loli.net/2020/01/08/fzxnrR5iguDjlHk.png" srcset="/img/loading.gif" alt="image-20200103144416930"></p><h3 id="6-å€’å…¥dashboard"><a href="#6-å€’å…¥dashboard" class="headerlink" title="6 å€’å…¥dashboard"></a>6 å€’å…¥dashboard</h3><p>æŠŠ kubernetesçš„Dashboardçš„æ¨¡æ¿å¯¼å…¥è¿›æ¥ï¼Œç›´æ¥æŠŠJSONæ ¼å¼å†…å®¹å¤åˆ¶è¿›æ¥ã€‚</p><p><img src="https://i.loli.net/2020/01/08/6XkA5hEjN1OWioS.png" srcset="/img/loading.gif" alt="image-20200103145516630"></p><h2 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h2><p><img src="https://i.loli.net/2020/01/08/bqEolIi8KVSGuHk.png" srcset="/img/loading.gif" alt="image-20200103145627198"></p><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ul><li><p><a href="https://jimmysong.io/kubernetes-handbook/practice/using-prometheus-to-monitor-kuberentes-cluster.html" target="_blank" rel="noopener">ä½¿ç”¨Prometheusç›‘æ§kubernetesé›†ç¾¤</a></p></li><li><p><a href="https://www.jianshu.com/p/ac8853927528" target="_blank" rel="noopener">k8så®‰è£…Prometheus+Grafana</a></p></li><li><p><a href="https://github.com/giantswarm/kubernetes-prometheus" target="_blank" rel="noopener">github-kubernetes-promethues</a></p></li><li><p><a href="https://github.com/giantswarm/prometheus" target="_blank" rel="noopener">github-giantswarm-promethues</a></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kubernetes</tag>
      
      <tag>grafana</tag>
      
      <tag>prometheus</tag>
      
      <tag>ç›‘æ§</tag>
      
      <tag>éƒ¨ç½²</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gitlabå¼€å¯Https</title>
    <link href="/2020/01/07/gitlab%E5%BC%80%E5%90%AFhttps/"/>
    <url>/2020/01/07/gitlab%E5%BC%80%E5%90%AFhttps/</url>
    
    <content type="html"><![CDATA[<h2 id="Gitlabå¼€å¯Https"><a href="#Gitlabå¼€å¯Https" class="headerlink" title="Gitlabå¼€å¯Https"></a>Gitlabå¼€å¯Https</h2><h3 id="å»ºç«‹è®¤è¯ç›®å½•"><a href="#å»ºç«‹è®¤è¯ç›®å½•" class="headerlink" title="å»ºç«‹è®¤è¯ç›®å½•"></a>å»ºç«‹è®¤è¯ç›®å½•</h3><pre><code class="shell">mkdir -p /etc/gitlab/sslchmod 700 /etc/gitlab/ssl</code></pre><h3 id="å»ºç«‹è¯ä¹¦"><a href="#å»ºç«‹è¯ä¹¦" class="headerlink" title="å»ºç«‹è¯ä¹¦"></a>å»ºç«‹è¯ä¹¦</h3><pre><code class="shell"># step 1 åˆ›å»ºprivate key ï¼ˆè®°ä½è¾“å…¥çš„å¯†ç ï¼ˆPass phraseï¼‰ï¼‰openssl genrsa -des3 -out /etc/gitlab/ssl/server.key 2048# step 2 ç”Ÿæˆ Certificate Requestopenssl req -new -key /etc/gitlab/ssl/gitlab.domain.com.key -out /etc/gitlab/ssl/server.csr</code></pre><blockquote><p> Enter Country Name CN<br> Enter State or Province Full Name HB<br> Enter City Name WuHan<br> Enter Organization Name<br> Enter Company Name EV-IV<br> Enter Organizational Unit Name<br> Enter server hostname i.e. URL gitlab.domain.com<br> Enter Admin Email Address<br> Skip Challenge Password (Hit Enter)<br> Skip Optional Company Name (Hit Enter)</p></blockquote><pre><code class="shell">#åœ¨åŠ è½½SSLæ”¯æŒçš„Nginxå¹¶ä½¿ç”¨ä¸Šè¿°ç§é’¥æ—¶è¦é™¤å»åˆšæ‰è®¾ç½®çš„å£ä»¤ï¼š #step3 å¤‡ä»½csræ–‡ä»¶åŠå»é™¤å‘½ä»¤ï¼Œç›´æ¥è¦†ç›–äº†server.keyäº†openssl rsa -inserver.key.org -out server.key#step 4æœ€åæ ‡è®°è¯ä¹¦ä½¿ç”¨ä¸Šè¿°ç§é’¥å’ŒCSRï¼šï¼ˆæŠŠcsræ ‡è®°åè½¬æ¢æˆäº†crt nginxè¦ç”¨keyå’Œcrtæ–‡ä»¶ï¼‰openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt</code></pre><h3 id="ä¿®æ”¹gitlabé…ç½®"><a href="#ä¿®æ”¹gitlabé…ç½®" class="headerlink" title="ä¿®æ”¹gitlabé…ç½®"></a>ä¿®æ”¹gitlabé…ç½®</h3><pre><code class="shell">vim /etc/gitlab/gitlab.rbexternal_url &#39;https://161.189.27.8:8090/&#39;nginx[&#39;redirect_http_to_https&#39;]= truenginx[&#39;ssl_client_certificate&#39;] = &quot;/etc/gitlab/ssl/server.crt&quot;nginx[&#39;ssl_certificate&#39;]= &quot;/etc/gitlab/ssl/server.crt&quot;nginx[&#39;ssl_certificate_key&#39;]= &quot;/etc/gitlab/ssl/server.key&quot;</code></pre><h3 id="é‡å¯gitlab"><a href="#é‡å¯gitlab" class="headerlink" title="é‡å¯gitlab"></a>é‡å¯gitlab</h3><pre><code class="shell">gitlab-ctl reconfiguregitlab-ctl restart</code></pre><p>æœ€åé€šè¿‡è®¿é—®httpsåœ°å€è¿›è¡Œè®¿é—®æµ‹è¯•</p><h3 id="ç›¸å…³é—®é¢˜"><a href="#ç›¸å…³é—®é¢˜" class="headerlink" title="ç›¸å…³é—®é¢˜"></a>ç›¸å…³é—®é¢˜</h3><p>Q1 ç”±äºsslè¯ä¹¦ä¸ºè‡ªç­¾è¯ä¹¦ git cloneæŠ¥é”™</p><pre><code class="shell">git clone https://161.189.27.8:8090/dqdev/pythogoras.gitCloning into &#39;pythogoras&#39;...fatal: unable to access &#39;https://161.189.27.8:8090/dqdev/pythogoras.git/&#39;: SSL certificate problem: self signed certificate</code></pre><p>å…³é—­git ssléªŒè¯</p><pre><code class="bash">git config --global http.sslVerify false å…³é—­git config --global http.sslVerify true  å¼€å¯</code></pre>]]></content>
    
    
    <categories>
      
      <category>è¿ç»´</category>
      
    </categories>
    
    
    <tags>
      
      <tag>gitlab</tag>
      
      <tag>ssl</tag>
      
      <tag>https</tag>
      
      <tag>è¯ä¹¦</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
